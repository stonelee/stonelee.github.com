<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Stonelee's Blog]]></title>
  <link href="http://stonelee.info/atom.xml" rel="self"/>
  <link href="http://stonelee.info/"/>
  <updated>2012-05-19T22:03:19+08:00</updated>
  <id>http://stonelee.info/</id>
  <author>
    <name><![CDATA[stonelee]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[ExtJS 4 mvc架构演化]]></title>
    <link href="http://stonelee.info/blog/2012/04/26/new-extjs-mvc/"/>
    <updated>2012-04-26T00:00:00+08:00</updated>
    <id>http://stonelee.info/blog/2012/04/26/new-extjs-mvc</id>
    <content type="html"><![CDATA[<p>从年前技术选型开始算起，使用Extjs 4已经四五个月时间了。对比之前的3.x版本，Extjs 4给了我们太多的惊喜：全新的mvc架构、强大的class体系、灵活的js加载方式、纯div布局页面。因此，项目组毫不犹豫地选择其作为前端架构进行新项目的开发。</p>

<p>项目初始时，我们一直遵循推荐的MVC架构：在view中配置页面控件，controller中编写业务逻辑。但随着项目的推进，模块代码越来越多，加之由于种种原因开发时间严重缩短，没有时间进行代码评审，controller中的代码灵活性过强，调用页面控件方式相对繁琐等问题逐渐暴露出来，页面基本无法复用，controller一片狼藉。</p>

<h2>第一次重构</h2>

<p>在用户桌面widget开发时，发现新widget与原模块中的view很像，但是在store,pagingtoolbar等方面略有差别，而controller中的逻辑非常杂乱，一个文件包含了整个模块的业务逻辑，维护和复用都相当困难。</p>

<p>重构结果总结如下:</p>

<ul>
<li>将controller中的业务逻辑尽量移到view中，采用js闭包实现逻辑的相对隔离，跨多view的逻辑依然放在controller中，达到维护容易和代码复用的目的。</li>
<li>采用extend的方式简化view开发</li>
<li>操作按钮尽量使用inline方式，便于用户使用，也有利于集成到其他view中。</li>
<li>add和edit两个界面合为一个，简化开发和维护工作量</li>
<li>store.sync后回传的数据可能与grid中的column不符，这时无法享用自动load的好处，因此应该使用model来save。grid同时使用pagingtoolbar时必须用model来save，然后load，否则pagingtoolbar不能更新。</li>
</ul>


<h2>第二次重构</h2>

<p>业务逻辑移到view中，满足了页面间高内聚、低耦合的设计要求，但是view之间相对独立的特点导致了无法实现逻辑代码复用的问题。</p>

<p>经研究，可以使用mixin来实现逻辑的复用。</p>

<p>例如Grid可以拆分为Columns（基本列）,Crud（增删改）,Operate（操作）,filter（筛选）等minin类,这几个类都包含了控件和业务逻辑,可以灵活配置在各个view中。</p>

<p><img src="http://stonelee.info/images/blog/Extjs-New-MVC.png" alt="" /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ExtJS 4打包工具]]></title>
    <link href="http://stonelee.info/blog/2012/02/16/extjs-4-build-tool/"/>
    <updated>2012-02-16T00:00:00+08:00</updated>
    <id>http://stonelee.info/blog/2012/02/16/extjs-4-build-tool</id>
    <content type="html"><![CDATA[<p>ExtJS 4采用新的MVC思路进行开发。 在项目开发阶段这种分散式的代码组织方式是很爽的，但是应用到生产环境中时为了减少服务端压力，需要对js文件进行压缩打包。 为解决这一问题，官方提供了打包工具<a href="http://www.sencha.com/products/jsbuilder">JSBuilder</a>, 使用方法如下：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>创建jsb文件：<span class="nv">$sencha</span> create jsb -a http://localhost/helloext/index.html -p app.jsb3
</span><span class='line'>构建：<span class="nv">$sencha</span> build -p app.jsb3 -d .
</span></code></pre></td></tr></table></div></figure>


<p>但在实际使用时发现，不知道是因为水土不服还是我们的项目结构不合sencha的胃口。在构建jsb3文件的时候不是完全找不到任何路径，就是缺少大量项目文件，可以说是相当鸡肋。</p>

<p>不如自己来吧！</p>

<p>经测试发现，只要按照依赖顺序，将所有文件归置到一个文件中，然后压缩，项目即可正常调用。</p>

<p>打包工具已经放到github上:<a href="https://github.com/stonelee/extjs4-build-tool">https://github.com/stonelee/extjs4-build-tool</a></p>

<h2>思路</h2>

<p>将app下的js文件按照model, store, view, controller的顺序来创建jsb3。</p>

<p>如果view中使用requires加载其它view，则按照依赖顺序先行加载。</p>

<p>然后针对项目需求做了点修改，将app.js按Ext.application分成两部分，分别加载到最后生成的文件中。</p>

<h2>技术点</h2>

<ul>
<li>按照依赖加载关系进行排列<a href="https://github.com/stonelee/extjs4-build-tool/blob/master/sort.py">sort.py</a></li>
<li>文本解析<a href="https://github.com/stonelee/extjs4-build-tool/blob/master/parse.py">parse.py</a></li>
</ul>


<h2>使用方法</h2>

<p>本工具仅仅将项目开发中自己创建的位于app文件夹中的model, store, view, controller以及用于项目整合的app.js打包成一个文件。
其它ExtJS或者ux文件还需要自己打包。
将build-tool放到app同级目录下，项目文档结构如下：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>|app
</span><span class='line'>|--controller
</span><span class='line'>|--model
</span><span class='line'>|--store
</span><span class='line'>|--view
</span><span class='line'>|build-tool
</span><span class='line'>|all.js
</span></code></pre></td></tr></table></div></figure>


<p>最终生成文件：</p>

<ul>
<li>app.jsb3 压缩文件路径信息</li>
<li>all-debug.js 未压缩的打包文件,供调试使用</li>
<li>all.js 压缩打包文件,生产环境使用</li>
</ul>


<p>ps:</p>

<p>从开始研究Ext打包，形成思路，到最终完成完整的打包工具并应用到项目中一共用了两天时间，其中纯python编码时间也就半天时间，看来经过这半年的js编码之后，我的python还没太手生嘛哈哈。动态语言之间的学习可以互相促进？待验证~</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ext Core设计模式]]></title>
    <link href="http://stonelee.info/blog/2012/02/01/ext-core-design-pattern/"/>
    <updated>2012-02-01T00:00:00+08:00</updated>
    <id>http://stonelee.info/blog/2012/02/01/ext-core-design-pattern</id>
    <content type="html"><![CDATA[<p>参考:
<a href="http://docs.sencha.com/core/manual/">http://docs.sencha.com/core/manual/</a></p>

<h2>Singletons 单例模式</h2>

<p>适用于只有static method或者只需要实例化一次的类，例如应用入口类。可以隐藏私有variables和methods</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">MyApp</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">data</span><span class="p">;</span> <span class="c1">//data is private and can&#39;t be accessed from outside.</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;init&#39;</span><span class="p">);</span>
</span><span class='line'>          <span class="c1">//Initialize application here</span>
</span><span class='line'>      <span class="p">},</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">getData</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">return</span> <span class="nx">data</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'><span class="p">}</span> <span class="p">();</span>
</span><span class='line'><span class="nx">Ext</span><span class="p">.</span><span class="nx">onReady</span><span class="p">(</span><span class="nx">MyApp</span><span class="p">.</span><span class="nx">init</span><span class="p">,</span> <span class="nx">MyApp</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Observable观察者模式</h2>

<p>Ext.util.Observable使用events实现在多个objects之间解耦</p>

<p>事件触发流程：state changes -> fire event -> notified</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">MyClass</span> <span class="o">=</span> <span class="nx">Ext</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Ext</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">Observable</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">constructor</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">addEvents</span><span class="p">(</span><span class="s1">&#39;datachanged&#39;</span><span class="p">);</span> <span class="c1">//specify the events we&#39;re going to fire</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">update</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">fireEvent</span><span class="p">(</span><span class="s1">&#39;datachanged&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// To subscribe to an event</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyClass</span><span class="p">();</span>
</span><span class='line'><span class="nx">c</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;datachanged&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">num</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">num</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'><span class="nx">c</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;some&#39;</span><span class="p">);</span> <span class="c1">//3</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Composite 组合模式</h2>

<p>将对象组与单一对象作统一处理，方便用户调用</p>

<p>例如使用select取得的Ext.CompositeElement跟Ext.Element具有同样的调用接口</p>

<h2>Flyweight 享元模式</h2>

<p>使用共有的object，避免创建额外对象，减少内存占用，适用于单行原子操作。</p>

<ul>
<li>使用Ext.fly来以享元的方式获取Element,只能一次性使用</li>
<li>Ext.get可以获取Element，然后保存以供未来使用</li>
<li>Ext.getDom获取dom node</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ext Core学习笔记]]></title>
    <link href="http://stonelee.info/blog/2012/01/30/ext-core-record/"/>
    <updated>2012-01-30T00:00:00+08:00</updated>
    <id>http://stonelee.info/blog/2012/01/30/ext-core-record</id>
    <content type="html"><![CDATA[<p>Ext Core与jQuery类似，提供了跨浏览器的js封装。
主要功能包括DOM操作，Ajax，Event，Animation，template，OO等。
作为类库它提供了更高层次的抽象，方便具体问题的解决
参考: <a href="http://docs.sencha.com/core/manual/">http://docs.sencha.com/core/manual/</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">Ext</span><span class="p">.</span><span class="nx">onReady</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">Ext</span><span class="p">.</span><span class="nx">DomHelper</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span> <span class="p">{</span><span class="nx">tag</span><span class="o">:</span> <span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="nx">cls</span><span class="o">:</span> <span class="s1">&#39;some-class&#39;</span><span class="p">});</span>
</span><span class='line'>    <span class="nx">Ext</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;p.some-class&#39;</span><span class="p">).</span><span class="nx">update</span><span class="p">(</span><span class="s1">&#39;Ext Core successfully injected&#39;</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Class System</h2>

<ul>
<li>Ext.extend 创建新class，将新的properties/functions添加到prototype中,使用superclass引用父类</li>
<li>Ext.override 用来更改原来的class</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">Person</span> <span class="o">=</span> <span class="nx">Ext</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nb">Object</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">constructor</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">first</span><span class="p">,</span> <span class="nx">last</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">firstName</span> <span class="o">=</span> <span class="nx">first</span><span class="p">;</span> <span class="c1">//property</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">lastName</span> <span class="o">=</span> <span class="nx">last</span><span class="p">;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">getName</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">firstName</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">lastName</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">Developer</span> <span class="o">=</span> <span class="nx">Ext</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Person</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">getName</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isCoding</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">return</span> <span class="s1">&#39;Go Away!&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>          <span class="c1">// Access the superclass getName method</span>
</span><span class='line'>          <span class="k">return</span> <span class="nx">Developer</span><span class="p">.</span><span class="nx">superclass</span><span class="p">.</span><span class="nx">getName</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Developer</span><span class="p">(</span><span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="s1">&#39;Smith&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">getName</span><span class="p">());</span> <span class="c1">//John Smith</span>
</span><span class='line'><span class="nx">p</span><span class="p">.</span><span class="nx">isCoding</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">getName</span><span class="p">());</span> <span class="c1">//Go Away!</span>
</span></code></pre></td></tr></table></div></figure>


<p>prototype中的会被share，特别要注意{}会被多个子类共享修改，小心！！</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">MyClass</span> <span class="o">=</span> <span class="nx">Ext</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nb">Object</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// This object literal is now shared between all instances of MyClass.</span>
</span><span class='line'>  <span class="nx">baseParams</span><span class="o">:</span> <span class="p">{},</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">foo</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">baseParams</span><span class="p">.</span><span class="nx">bar</span> <span class="o">=</span> <span class="s1">&#39;baz&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">Ext</span><span class="p">.</span><span class="nx">onReady</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyClass</span><span class="p">();</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyClass</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">a</span><span class="p">.</span><span class="nx">foo</span><span class="p">();</span>
</span><span class='line'>  <span class="c1">// Modifying baseParams in a affects baseParams in b.</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">baseParams</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>apply 复制所有property</li>
<li>applyIf 对于重复的property则不复制</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">person</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;John Smith&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">age</span><span class="o">:</span> <span class="mi">30</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">hobby</span><span class="o">:</span> <span class="s1">&#39;Rock Band&#39;</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="nx">Ext</span><span class="p">.</span><span class="nx">applyIf</span><span class="p">(</span><span class="nx">person</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">hobby</span><span class="o">:</span> <span class="s1">&#39;Coding&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">city</span><span class="o">:</span> <span class="s1">&#39;London&#39;</span>
</span><span class='line'><span class="p">});</span> <span class="c1">// hobby is not copied over</span>
</span></code></pre></td></tr></table></div></figure>


<h2>函数</h2>

<p>函数式编程：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">sayHello</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">firstName</span><span class="p">,</span> <span class="nx">lastName</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;Hello &#39;</span> <span class="o">+</span> <span class="nx">firstName</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nx">lastName</span><span class="p">);</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'><span class="nx">Ext</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;myButton&#39;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">sayHello</span><span class="p">.</span><span class="nx">createCallback</span><span class="p">(</span><span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="s1">&#39;Smith&#39;</span><span class="p">));</span>
</span><span class='line'><span class="err">等价于</span>
</span><span class='line'><span class="nx">Ext</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;myButton&#39;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">sayHello</span><span class="p">(</span><span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="s1">&#39;Smith&#39;</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>TaskRunner用来固定时间间隔执行函数，例如每隔5s进行ajax请求，TaskMgr是TaskRunner的单例，用起来更方便</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">stop</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">task</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">run</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">stop</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">());</span>
</span><span class='line'>      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">runner</span><span class="p">.</span><span class="nx">stop</span><span class="p">(</span><span class="nx">task</span><span class="p">);</span> <span class="c1">// we can stop the task here if we need to.</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nx">interval</span><span class="o">:</span> <span class="mi">1000</span> <span class="c1">// every 1 seconds</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">runner</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Ext</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">TaskRunner</span><span class="p">();</span>
</span><span class='line'><span class="nx">runner</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span><span class="nx">task</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">stop</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'><span class="nx">Ext</span><span class="p">.</span><span class="nx">TaskMgr</span><span class="p">.</span><span class="nx">start</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">run</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">stop</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">());</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nx">interval</span><span class="o">:</span> <span class="mi">1000</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>DelayedTask 延时触发事件，如果在延时时间内触发两次事件，则后一次事件会覆盖前一次的触发</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">task</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Ext</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">DelayedTask</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">Ext</span><span class="p">.</span><span class="nx">getDom</span><span class="p">(</span><span class="s1">&#39;myInputField&#39;</span><span class="p">).</span><span class="nx">value</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'><span class="c1">// Wait 500ms before calling our function. If the user presses another key </span>
</span><span class='line'><span class="c1">// during that 500ms, it will be cancelled and we&#39;ll wait another 500ms.</span>
</span><span class='line'><span class="nx">Ext</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;myInputField&#39;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;keypress&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">task</span><span class="p">.</span><span class="nx">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>延时函数：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">task</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Ext</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">DelayedTask</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">Ext</span><span class="p">.</span><span class="nx">getDom</span><span class="p">(</span><span class="s1">&#39;myInputField&#39;</span><span class="p">).</span><span class="nx">value</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'><span class="c1">// Wait 500ms before calling our function. If the user presses another key </span>
</span><span class='line'><span class="c1">// during that 500ms, it will be cancelled and we&#39;ll wait another 500ms.</span>
</span><span class='line'><span class="nx">Ext</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;myInputField&#39;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;keypress&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">task</span><span class="p">.</span><span class="nx">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">whatsTheTime</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>    <span class="nx">alert</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">());</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'><span class="nx">whatsTheTime</span><span class="p">.</span><span class="nx">defer</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span> <span class="c1">//Wait 3 seconds before executing.</span>
</span></code></pre></td></tr></table></div></figure>


<h2>格式</h2>

<p>urlEncode、urlDecode将object-literal与GET request parameter（key1=value1&amp;key2=value2）互相转化</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">foo</span><span class="o">:</span> <span class="s1">&#39;value1&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">bar</span><span class="o">:</span> <span class="mi">100</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">Ext</span><span class="p">.</span><span class="nx">encode</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span> <span class="c1">// s is now foo=value1&amp;bar=100</span>
</span></code></pre></td></tr></table></div></figure>


<p>encode、decode将object与json互相转换</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">Ext</span><span class="p">.</span><span class="nx">encode</span><span class="p">({</span>
</span><span class='line'>    <span class="nx">foo</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">bar</span><span class="o">:</span> <span class="mi">2</span>
</span><span class='line'><span class="p">});</span> <span class="c1">//&quot;{&quot;foo&quot;:1,&quot;bar&quot;:2}&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>字符串格式化：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="nb">String</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span>
</span><span class='line'>   <span class="s1">&#39;Hey {0} {1}&#39;</span><span class="p">,</span> <span class="nx">how</span> <span class="nx">are</span> <span class="nx">you</span><span class="o">?</span><span class="s1">&#39;, </span>
</span><span class='line'><span class="s1">   &#39;</span><span class="nx">John</span><span class="s1">&#39;, </span>
</span><span class='line'><span class="s1">   &#39;</span><span class="nx">Smith</span><span class="err">&#39;</span>
</span><span class='line'><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<h2>DOM</h2>

<p>DomQuery提供了高性能的selector/xpath处理，可以应用于html和xml，主要使用select函数，可以使用get预先获取Root来进一步提升性能</p>

<ul>
<li>多重选择 Ext.select(&#8216;div.foo, span.bar&#8217;);</li>
<li>链式选择 Ext.select(&#8216;div.foo[title=bar]:first&#8217;);</li>
<li>子选择 Ext.select(&#8216;div span&#8217;);</li>
<li>直接子选择 Ext.select(&#8216;ul > li&#8217;);</li>
<li>属性选择 Ext.select(&#8216;a[href=http://extjs.com]&#8217;);</li>
<li>有alt tag Ext.select(&#8216;img[alt]&#8217;);</li>
<li>伪类 Ext.select(&#8216;div:next(span.header));</li>
<li>css值选择 E{display<sup>=none}</sup> //css value &#8220;display&#8221; that starts with &#8220;none&#8221;</li>
</ul>


<p>DomHelper动态生成html片段：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">Ext</span><span class="p">.</span><span class="nx">DomHelper</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;my-div&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">cn</span><span class="o">:</span> <span class="p">[{</span>
</span><span class='line'>      <span class="nx">tag</span><span class="o">:</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">href</span><span class="o">:</span> <span class="s1">&#39;http://www.yahoo.com/&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">html</span><span class="o">:</span> <span class="s1">&#39;My Link&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">target</span><span class="o">:</span> <span class="s1">&#39;_blank&#39;</span>
</span><span class='line'>    <span class="p">}]</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Ext.Element</h2>

<p>浏览器加载页面时，将每个tag解析为HTMLElement，建立DOM，保存到全局变量document里。使用getElementById来获取每个HTMLElement
Ext.Element屏蔽DOM操作的浏览器差异，功能包括：</p>

<h3>CSS &amp; Styling(setStyle, addClass)</h3>

<ul>
<li>radioClass实现单选效果，同类中有同样class则remove，否则add</li>
<li>toggleClass切换</li>
</ul>


<h3>Dom Querying or Traversal(query, select, findParent)</h3>

<p>is 测试element是否符合selector</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">//向上找parent:</span>
</span><span class='line'><span class="nx">Ext</span><span class="p">.</span><span class="nx">fly</span><span class="p">(</span><span class="s1">&#39;elId&#39;</span><span class="p">).</span><span class="nx">findParent</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span> <span class="c1">//returns a dom node</span>
</span><span class='line'><span class="nx">Ext</span><span class="p">.</span><span class="nx">fly</span><span class="p">(</span><span class="s1">&#39;elId&#39;</span><span class="p">).</span><span class="nx">up</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span> <span class="c1">//返回Ext.Element</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//查找</span>
</span><span class='line'><span class="nx">Ext</span><span class="p">.</span><span class="nx">fly</span><span class="p">(</span><span class="s1">&#39;elId&#39;</span><span class="p">).</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;div:nth-child(2)&#39;</span><span class="p">);</span> <span class="c1">//返回CompositeElement</span>
</span><span class='line'><span class="nx">Ext</span><span class="p">.</span><span class="nx">fly</span><span class="p">(</span><span class="s1">&#39;elId&#39;</span><span class="p">).</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;div:nth-child(2)&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span> <span class="c1">//返回Array of elements</span>
</span><span class='line'><span class="nx">Ext</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="s1">&#39;div:nth-child(2)&#39;</span><span class="p">);</span> <span class="c1">//返回Array of dom nodes</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//返回Ext.Element，第二参数为true则返回dom node</span>
</span><span class='line'><span class="nx">Ext</span><span class="p">.</span><span class="nx">fly</span><span class="p">(</span><span class="s1">&#39;elId&#39;</span><span class="p">).</span><span class="nx">child</span><span class="p">(</span><span class="s1">&#39;p.highlight&#39;</span><span class="p">);</span> <span class="c1">//任意深度的single child</span>
</span><span class='line'><span class="nx">Ext</span><span class="p">.</span><span class="nx">fly</span><span class="p">(</span><span class="s1">&#39;elId&#39;</span><span class="p">).</span><span class="nx">down</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">);</span>  <span class="c1">//直接single child</span>
</span></code></pre></td></tr></table></div></figure>


<p>还有parent()，next()，prev()，first()，last()</p>

<h3>Dom Manipulation(createChild, remove)</h3>

<p>使用id或Ext.Element或dom node或selectors或CompositeElement</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">Ext</span><span class="p">.</span><span class="nx">fly</span><span class="p">(</span><span class="s1">&#39;elId&#39;</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="s1">&#39;elId2&#39;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>使用DomHelper config</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">Ext</span><span class="p">.</span><span class="nx">fly</span><span class="p">(</span><span class="s1">&#39;elId&#39;</span><span class="p">).</span><span class="nx">insertFirst</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">tag</span><span class="o">:</span> <span class="s1">&#39;p&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">html</span><span class="o">:</span> <span class="s1">&#39;Hi I am the new first child&#39;</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>使用Html Fragments</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">Ext</span><span class="p">.</span><span class="nx">fly</span><span class="p">(</span><span class="s1">&#39;elId&#39;</span><span class="p">).</span><span class="nx">insertHtml</span><span class="p">(</span><span class="s1">&#39;beforeBegin&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;p&gt;Hi&lt;/p&gt;&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>包括beforeBegin, beforeEnd, afterBegin, afterEnd</p>

<h3>Event Handling</h3>

<p>Ext.EventObject提供了跨浏览器的event实现，例如按键判断，event-propagation ，preventDefault()</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">el</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// e is a normalized event object (Ext.EventObject)</span>
</span><span class='line'>  <span class="c1">// t the target that was clicked, this is an Ext.Element.      </span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'><span class="nx">el</span><span class="p">.</span><span class="nx">un</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">handlerFn</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Event delegation是利用冒泡机制在container中注册event，而不是在每个元素中注册，这样可以减少内存消耗，防止内存泄漏，更好地集中管理event</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">Ext</span><span class="p">.</span><span class="nx">fly</span><span class="p">(</span><span class="s1">&#39;actions&#39;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click, function(e,t) {</span>
</span><span class='line'><span class="s1"> switch(t.id) {</span>
</span><span class='line'><span class="s1">     case &#39;&#39;btn-edit&#39;</span><span class="o">:</span>
</span><span class='line'>      <span class="c1">// handle the event</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>      <span class="k">case</span> <span class="s1">&#39;btn-delete&#39;</span><span class="o">:</span>
</span><span class='line'>      <span class="c1">// handle the event</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>configuration option:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">el</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// handle click</span>
</span><span class='line'><span class="p">},</span> <span class="k">this</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">delegate</span><span class="o">:</span> <span class="s1">&#39;.clickable&#39;</span><span class="p">,</span><span class="c1">// will filter target to be a descendant with the class &#39;clickable&#39;</span>
</span><span class='line'>    <span class="nx">single</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// 只响应一次，然后自动删除</span>
</span><span class='line'>    <span class="nx">buffer</span><span class="o">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="c1">// 延时1s，如果在时间间隔内多次触发会覆盖</span>
</span><span class='line'>    <span class="nx">delay</span><span class="o">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="c1">// 延时1s，不会覆盖</span>
</span><span class='line'>    <span class="nx">target</span><span class="o">:</span> <span class="nx">el</span><span class="p">.</span><span class="nx">up</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">)</span> <span class="c1">// only handles the event when it has bubbled up to the first &#39;div&#39;.</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>hover</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">function</span> <span class="nx">over</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">t</span><span class="p">){</span>
</span><span class='line'>    <span class="nx">Ext</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span><span class="nx">toggleClass</span><span class="p">(</span><span class="s1">&#39;red&#39;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="kd">function</span> <span class="nx">out</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">t</span><span class="p">){</span>
</span><span class='line'>    <span class="nx">Ext</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">t</span><span class="p">).</span><span class="nx">toggleClass</span><span class="p">(</span><span class="s1">&#39;red&#39;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nx">Ext</span><span class="p">.</span><span class="nx">fly</span><span class="p">(</span><span class="s1">&#39;myButton&#39;</span><span class="p">).</span><span class="nx">hover</span><span class="p">(</span><span class="nx">over</span><span class="p">,</span> <span class="nx">out</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Dimensions(getHeight, getWidth)</h3>

<p>可以添加动画configure或直接true</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// changes the height to 200px and animates with default configuration</span>
</span><span class='line'><span class="nx">Ext</span><span class="p">.</span><span class="nx">fly</span><span class="p">(</span><span class="s1">&#39;elId&#39;</span><span class="p">).</span><span class="nx">setHeight</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// changes the height to 150px and animates with a custom configuration</span>
</span><span class='line'><span class="nx">Ext</span><span class="p">.</span><span class="nx">fly</span><span class="p">(</span><span class="s1">&#39;elId&#39;</span><span class="p">).</span><span class="nx">setHeight</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">duration</span> <span class="o">:</span> <span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="c1">// animation will have a duration of .5 seconds</span>
</span><span class='line'>    <span class="c1">// will change the content to &quot;finished&quot;</span>
</span><span class='line'>    <span class="nx">callback</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span> <span class="k">this</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="s2">&quot;finished&quot;</span><span class="p">);</span> <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">getPadding</span><span class="p">(</span><span class="s1">&#39;lrtb&#39;</span><span class="p">);</span><span class="c1">//返回四个方向padding之和</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//同时得到x,y坐标</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">elXY</span> <span class="o">=</span> <span class="nx">Ext</span><span class="p">.</span><span class="nx">fly</span><span class="p">(</span><span class="s1">&#39;elId&#39;</span><span class="p">).</span><span class="nx">getXY</span><span class="p">()</span> <span class="c1">//elXY is an array</span>
</span><span class='line'><span class="nx">Ext</span><span class="p">.</span><span class="nx">fly</span><span class="p">(</span><span class="s1">&#39;elId&#39;</span><span class="p">).</span><span class="nx">setXY</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">])</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//得到相对位置</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">elOffsets</span> <span class="o">=</span> <span class="nx">Ext</span><span class="p">.</span><span class="nx">fly</span><span class="p">(</span><span class="s1">&#39;elId&#39;</span><span class="p">).</span><span class="nx">getOffsetsTo</span><span class="p">(</span><span class="nx">anotherEl</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//设置位置</span>
</span><span class='line'><span class="nx">setLocation</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">32</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>clearPositioning，getPositioning，setPositioning用来存储恢复position</p>

<h3>Animations</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">//共八个方向，&#39;r&#39;表示朝右边滑动</span>
</span><span class='line'><span class="nx">Ext</span><span class="p">.</span><span class="nx">fly</span><span class="p">(</span><span class="s1">&#39;slideEl&#39;</span><span class="p">).</span><span class="nx">slideOut</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">callback</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>      <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;Finished sliding the element out&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[恶搞jquery]]></title>
    <link href="http://stonelee.info/blog/2011/11/30/trick-on-jquery/"/>
    <updated>2011-11-30T00:00:00+08:00</updated>
    <id>http://stonelee.info/blog/2011/11/30/trick-on-jquery</id>
    <content type="html"><![CDATA[<p>有人使用jquery来get服务端数据吗？
相信略微有点功能的jquery程序都会使用把。</p>

<h2>trick</h2>

<p>前提确定，恶作剧开始。
将下面代码插入任意js文件的可执行位置:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">fuck</span><span class="o">=</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>  <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;fuck u!!!&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<h2>效果</h2>

<p>在我的系统中每隔5s向服务端请求一次数据，因此每隔5s会弹出一个温馨的祝福框。</p>

<h2>原因</h2>

<p>查看console没有任何异常啊，why？？
将那个可爱的alert换为console.log，发现console出现了位置定位jquery-1.7.js (line 7611)，点过去看看：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="k">for</span> <span class="p">(</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">{</span> <span class="nx">success</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">error</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">complete</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">jqXHR</span><span class="p">[</span> <span class="nx">i</span> <span class="p">](</span> <span class="nx">s</span><span class="p">[</span> <span class="nx">i</span> <span class="p">]</span> <span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>jquery作者肿么了，object的for循环竟然没用hasOwnProperty来判断一下！！
然后看了下周围的代码，也都是一样滴！！
为了代码的简洁吗？为了运行的效率吗？基于用户的善意考虑吗？在js的prototype继承机制上，一切都是浮云~</p>

<p>如此明显的bug估计在jquery看来是有意为之的，但是为防止自己的代码被问候，建议自己的代码按照这样的方式书写：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">obj</span><span class="o">=</span><span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="s2">&quot;tom&quot;</span><span class="p">,</span><span class="nx">age</span><span class="o">:</span><span class="mi">13</span><span class="p">};</span>
</span><span class='line'><span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">obj</span><span class="p">){</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">i</span><span class="p">)){</span>
</span><span class='line'>      <span class="nx">doSomething</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>这也是每本专业js书里的推荐写法。</p>

<h2>ps</h2>

<p>如果有人用这种方法捣乱，文件夹搜索Object.prototype即可。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[chrome15中无法使用svg的currentScale方法]]></title>
    <link href="http://stonelee.info/blog/2011/11/11/currentscale-bug-of-svg-in-chrome15/"/>
    <updated>2011-11-11T00:00:00+08:00</updated>
    <id>http://stonelee.info/blog/2011/11/11/currentscale-bug-of-svg-in-chrome15</id>
    <content type="html"><![CDATA[<p><a href="http://stonelee.info/demos/currentscale_bug_in_chrome15/index.html">测试网址</a></p>

<p>已提交bug，待解决</p>

<h2>ps</h2>

<p>chrome开发者已添加Labels: -Area-Undefined Area-WebKit</p>

<h2>ps</h2>

<p>chrome 13中是可以缩放的，因此继续研究，结果在定点缩放这一功能实现时发现大问题：</p>

<p>放大，即currentScale *= 1.1时,
当前鼠标的clientX减小，即event.clientX /= 1.1,
但是图形中的点clientX不变</p>

<p>移动，即currentTranslate.x -=10 时,
当前鼠标clientX不变，
但是图形中的点clientX -=10</p>

<p>即缩放是浏览器行为，不改变图形client坐标，而移动是svg行为，会改变图形client坐标。</p>

<p>两者的实现如此不一致，怪不得chrome 15中currentScale失效了，而currentTranslate没有。
Google是不是把资源都放到canvas上了，svg这么明显的bug都不管。。。</p>

<p>firefox下都是图形坐标改变，鼠标不变。很容易就能实现定点缩放功能。</p>

<h2>ps</h2>

<p>经反复研究发现，ie端支持svg的Chrome Frame方案不够成熟，该控件体积有20多M，安装需要几分钟，而且时常安装失败，安装体验太差。最重要的是chrome中svg缩放移动条件下鼠标定位与svg坐标换算非常诡异，经两天研究仍无法完美解决，导致无法实现定点缩放功能。页面初次加载也不够快（可能是gcf方式加载的问题），用户体验一般。
所以&#8230;放弃&#8230;</p>

<p>换用Adobe svg viewer吧。。。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[IE6下渲染svg的解决方案]]></title>
    <link href="http://stonelee.info/blog/2011/10/24/svg-solution-in-ie6/"/>
    <updated>2011-10-24T00:00:00+08:00</updated>
    <id>http://stonelee.info/blog/2011/10/24/svg-solution-in-ie6</id>
    <content type="html"><![CDATA[<p>IE6下svg的渲染是个问题，目前主要有以下几种解决方案：</p>

<h2><a href="http://code.google.com/p/svgweb/">svgweb</a></h2>

<p>优点:开源，可在不支持svg的浏览器中使用flash来渲染，有效解决客户端下载插件问题</p>

<p>缺点:svg封装不完全，flash渲染效率比较低，刷新页面时内存泄漏严重</p>

<h2><a href="http://www.adobe.com/svg/viewer/install/">adobe SVGViewer</a></h2>

<p>优点：对svg支持较好</p>

<p>缺点：adobe已于2009年1月份明确表示不再提供支持，需要客户端下载插件</p>

<h2><a href="http://code.google.com/intl/zh-CN/chrome/chromeframe/">Chrome Frame</a></h2>

<p>优点：IE下使用chrome模式来渲染，速度快，原生支持svg</p>

<h2>svgweb+chrome frame</h2>

<p>这时目前我们项目组所使用的解决方案，可以较好地满足我们的需求</p>

<ul>
<li>系统整体框架为遗留系统，IE only，这决定了我们的客户必须使用IE（煤矿客户本来就对此喜闻乐见）</li>
<li>一般客户端使用频率较低，使用svgweb提供的flash渲染，不用下载flash以外的插件</li>
<li>监控中心中客户端数量较少，而且设备可控，使用chromeframe渲染svg单页面，渲染效率高，减少内存泄漏</li>
</ul>


<h3>发现问题：</h3>

<p>在实际使用过程中发现，使用frame方式调用svg单页面时，通过指定chromeframe渲染头的方式是无效的:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;X-UA-Compatible&quot;</span> <span class="na">content=</span><span class="s">&quot;chrome=1&quot;</span><span class="nt">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>此时访问调用frameset的页面，会发现其依然是IE渲染，而单独访问该svg页面会使用chrome方式。</p>

<p><a href="http://groups.google.com/group/google-chrome-frame/browse_thread/thread/d5ffe442658bc60e/e6d7a4c1c179c931">网上讨论结果</a>是目前chromeframe只支持顶层meta tag检测，而且貌似也不打算修正这一问题。</p>

<h3>解决方案：</h3>

<p>经过不断尝试，发现有一个取巧方法可以解决此问题，即使用gcf前缀指定渲染方式，形如gcf:http://gmail.com
猛击 <a href="http://www.chromium.org/developers/how-tos/chrome-frame-getting-started#TOC-Testing-Your-Sites">参考网址</a></p>

<p>这需要修改注册表：HEKY_CURRENT_USER\Software\Google\ChromeFrame下新建DWORD类型的键 AllowUnsafeURLs=1
然后就可以这样调用该svg页面</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;frame</span> <span class="na">src=</span><span class="s">&quot;gcf:http://127.0.0.1/svg/index.html&quot;</span> <span class="na">name=</span><span class="s">&quot;MainFrame&quot;</span> <span class="na">id=</span><span class="s">&quot;MainFrame&quot;</span>  <span class="na">frameborder=</span><span class="s">&quot;0&quot;</span> <span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>如果要兼容没有安装chromeframe的浏览器，可以使用js动态更改。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">function</span> <span class="nx">IsGCFInstalled</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">try</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">if</span> <span class="p">(</span><span class="k">new</span> <span class="nx">ActiveXObject</span><span class="p">(</span><span class="s1">&#39;ChromeTab.ChromeFrame&#39;</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>              <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{}</span>
</span><span class='line'>      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">frame</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;frame&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">frame</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;MainFrame&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">frame</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;MainFrame&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">frame</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;frameborder&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nx">IsGCFInstalled</span><span class="p">())</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">frame</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">,</span> <span class="s1">&#39;gcf:http://10.10.22.84/develop/gmf/zhunqi/index.html&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">frame</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">,</span> <span class="s1">&#39;zhunqi/index.html&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="nx">$</span><span class="p">(</span><span class="nx">frame</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#TreeFrameSet&#39;</span><span class="p">));</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">})();</span>
</span></code></pre></td></tr></table></div></figure>


<h3>ps</h3>

<p>注册表中指定RenderInGcfUrls的方法也是无效的，原因估计等同于指定meta tag的方法。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[打造纯净前端开发环境(附nginx反向代理解决跨域问题)]]></title>
    <link href="http://stonelee.info/blog/2011/09/13/crossdomain-with-nginx-tornado-javascript/"/>
    <updated>2011-09-13T00:00:00+08:00</updated>
    <id>http://stonelee.info/blog/2011/09/13/crossdomain-with-nginx-tornado-javascript</id>
    <content type="html"><![CDATA[<p>最近在搞前端javascript编码, 公司项目使用的后台语言是.net和java,这些东西对于我而言太笨重了。而我钟爱的python又由于种种原因不能应用到项目中。因此需要一个比较纯净的前端开发测试环境，开发出来的代码可以容易的供其他后端语言使用。</p>

<h2>要求</h2>

<ul>
<li>能够实现前后台数据通信</li>
<li>保持前端纯洁性，不掺杂过多服务端代码</li>
<li>前端js使用相对url来获取数据,需要解决跨域问题</li>
</ul>


<h2>解决方案</h2>

<h3>静态服务器nginx</h3>

<p>提供前端html+js+css的静态展示</p>

<p>需要配置nginx.conf:
alias可以指定映射路径,
autoindex可以自动列出文件目录</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>location /develop <span class="o">{</span>
</span><span class='line'>  <span class="nb">alias</span>       <span class="s2">&quot;/home/lxd/Develop&quot;</span>;
</span><span class='line'>  autoindex   on;
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>后台测试服务器tornado</h3>

<p>不使用template_path和static_path,直接使用write来返回字符串数据,
服务端简化到只需一个文件,
tornado只用来产生数据，以独立应用的形式提供服务</p>

<h3>跨域问题</h3>

<p>使用nginx反向代理tornado服务器，来解决跨域问题</p>

<p>nginx.conf添加反向代理</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>location /develop/gmf/zhunqi/tornado <span class="o">{</span>
</span><span class='line'>  proxy_pass       <span class="s2">&quot;http://localhost:8888&quot;</span>;
</span><span class='line'>  proxy_redirect   off;
</span><span class='line'>  proxy_set_header X-Real-IP <span class="nv">$remote_addr</span>;
</span><span class='line'>  proxy_set_header X-Forwarded-For <span class="nv">$proxy_add_x_forwarded_for</span>;
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>tornado文件指定url映射</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="p">(</span><span class="s">r&quot;/develop/gmf/zhunqi/tornado/mines&quot;</span><span class="p">,</span> <span class="n">MineHandler</span><span class="p">),</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[解决ubuntu中激活显卡驱动导致启动黑屏问题]]></title>
    <link href="http://stonelee.info/blog/2011/08/30/resolve-ubuntu-blank-screen/"/>
    <updated>2011-08-30T00:00:00+08:00</updated>
    <id>http://stonelee.info/blog/2011/08/30/resolve-ubuntu-blank-screen</id>
    <content type="html"><![CDATA[<p>今天重新安装了ubuntu，准备作为个人开发的主环境。</p>

<p>晚上的时候忽然蹦出来个激活硬件驱动的提示，我手贱了下随手就点了，结果重启后系统就进不去了，一直是黑屏，连ctrl+alt+F1都进不去。</p>

<h2>解决方法</h2>

<p>重启，在GRUB中按e进入编辑，删除quiet and splash，如果是Nvidia显卡添加nomodeset，如果是ATI显卡添加nomodeset xforcevesa</p>

<p>按ctrl+x启动，然后会提示说找不到桌面，这时可以进入命令行了，删掉xorg.conf</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">cd</span> /etc/X11/
</span><span class='line'>sudo rm xorg.conf
</span></code></pre></td></tr></table></div></figure>


<p>然后就可以正常startx了</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[基于WebGL的魔兽争霸Demo]]></title>
    <link href="http://stonelee.info/blog/2011/08/21/warcraft3-threejs-blender-demo/"/>
    <updated>2011-08-21T00:00:00+08:00</updated>
    <id>http://stonelee.info/blog/2011/08/21/warcraft3-threejs-blender-demo</id>
    <content type="html"><![CDATA[<p>早就想基于魔兽争霸的模型做点东西，周末抽空研究了下，比较简单。</p>

<p>先看看效果。</p>

<p><img src="http://stonelee.info/images/blog/warcraft.jpg" alt="" /></p>

<h2>导出魔兽争霸模型</h2>

<p>Warcraft 3 Viewer可以读取warcraft的MPQ文件，从中选择中意的模型，然后可以分别将MDX和texture导出。为了后面使用的方便，texture导出到和mdx相同目录下，格式为jpg。</p>

<h2>导入到blender</h2>

<p>使用modelconv来将mdx文件转换为obj文件。modelconv是一个命令行程序，调用后，输入要转换的mdx文件名和要转换成的obj文件名即可。
然后使用blender来import该obj文件。</p>

<h2>调整模型</h2>

<p>自动导入的文件往往其大小和角度不符合实际需要，因此需要进行调整。</p>

<ul>
<li>缩放模型</li>
<li>调整模型位置</li>
<li>调整摄像机位置</li>
<li>删掉多余的面</li>
</ul>


<h2>贴纹理(texture)</h2>

<p>打开UV/Image Editor，打开贴图文件，在3D View视图中查看Textured视角，这时会发现模型已经自动贴好了纹理。但是这时候render的话会发现渲染出的模型依然是难看的灰色。因此需要新加一个Material，然后新加一个Texture，Type选择Image or Movie，Image选择之前的贴图文件，Mapping中Coordinates选择UV，这样才算真正贴好了纹理。</p>

<h2>导出three.js模型</h2>

<p>使用ThreeJS自带的blender导出插件，会自动将模型和纹理导成ThreeJS需要的json。只需将生成的js文件和texture复制到ThreeJS项目中即可正常使用。</p>

<h2>ThreeJS中调用模型</h2>

<p>注意调整模型位置，纹理会自动贴好。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">loader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">JSONLoader</span><span class="p">();</span>
</span><span class='line'><span class="nx">loader</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span> <span class="p">{</span> <span class="nx">model</span><span class="o">:</span> <span class="s2">&quot;warcraft/archer.js&quot;</span><span class="p">,</span> <span class="nx">callback</span><span class="o">:</span> <span class="nx">createScene</span> <span class="p">}</span> <span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">createScene</span><span class="p">(</span> <span class="nx">geometry</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">mesh</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Mesh</span><span class="p">(</span> <span class="nx">geometry</span><span class="p">,</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">MeshFaceMaterial</span><span class="p">());</span>
</span><span class='line'>    <span class="nx">mesh</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="o">=-</span><span class="mi">15</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">mesh</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="o">=-</span><span class="mi">5</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">mesh</span><span class="p">.</span><span class="nx">scale</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">mesh</span><span class="p">.</span><span class="nx">scale</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">mesh</span><span class="p">.</span><span class="nx">scale</span><span class="p">.</span><span class="nx">z</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">scene</span><span class="p">.</span><span class="nx">addObject</span><span class="p">(</span> <span class="nx">mesh</span> <span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[基于WebGL的矿井三维演示]]></title>
    <link href="http://stonelee.info/blog/2011/08/20/web-mine-demo-with-threejs/"/>
    <updated>2011-08-20T00:00:00+08:00</updated>
    <id>http://stonelee.info/blog/2011/08/20/web-mine-demo-with-threejs</id>
    <content type="html"><![CDATA[<p>用了一周的时间研究WebGL相关技术，发现该技术竟然已经发展到如此地步，足以应用于企业开发领域。因此我使用Blender建模，基于ThreeJS实现了一个能够在浏览器上运行的矿井结构的三维效果展示。</p>

<p><img src="http://stonelee.info/images/blog/webmine.jpg" alt="" /></p>

<p><img src="http://stonelee.info/images/blog/webmine2.jpg" alt="" /></p>

<h2>浏览器兼容</h2>

<p>Chrome和Firefox的较新版本均可流畅运行,
IE8需要借助ChromeFrame插件</p>

<h2>平台兼容</h2>

<p>基于浏览器的应用，完美跨平台。
经测试在手机Android2.3的Firefox中也可以显示。</p>

<h2>主要功能</h2>

<ul>
<li>鼠标对模型的自由旋转、缩放、平移</li>
<li>巷道文字显示</li>
<li>人员移动轨迹回放，在模型中显示</li>
<li>传感器在巷道模型上定点显示</li>
<li>点击传感器，显示从后台服务器中取得的环境参数</li>
<li>轮询方式从后台取得报警信息，在界面上展示。</li>
<li>使用DAT.GUI实现模型参数的实时显示和动态更改。</li>
</ul>


<h2>感想</h2>

<p>发展眼光很重要。新技术浪潮的到来往往会伴随行业洗牌，传统巨头会在一系列历史遗留问题中纠缠不清，无法很好的转移航向来适应未来的发展。新入行者恰恰可以利用后发优势，凭借新技术的潮头，爆发似的抢占市场。新技术不可怕，可怕的是技术上畏首畏尾，不敢突破的心态。跟在别人屁股后面永远只能吃那个。勇于打破既有规则，实现对既有规则的颠覆，建立自己的游戏规则，自己带着别人在圈子里玩，这才是我们应该做的事情。</p>

<p>跨平台很重要，未来不再是windows的天下，随着智能手机和平板电脑的日益普及和流行，Linux系愈发强势。微软早就不是以前的巨无霸，谷歌苹果已经成为新生代的巨头。.net系的技术经常随市场一变再变，千万不要妄想抱住某厂商的大粗腿，民主化的开源社区才是王道（当然没有各大厂商的财力支持也是白搭）。</p>

<p>基于浏览器的应用开发很重要，基于云端的浏览器应用是业界趋势。虽然基于系统原生的程序性能更强，用户体验更好，但是多平台开发需要多语言的移植，对于小公司来说从无论从人力物力还是发维护成本都是不可能的。而且根据摩尔定律，硬件性能越来越强，价格越来越便宜，我们要做的只是等待，而且不会等待太久。</p>

<p>人很重要。好的程序员的工作效率会是垃圾程序员的数十倍，但是工资往往不需要这么多，他们更希望的是得到认可、得到尊重。好的程序员是自我管理的，他们无聊的时候也在学习，因为这是一种乐趣，他们工作效率极高，但从不加班。他们厌恶浪费生命的会议，厌恶一切不必要的手续和流程，厌恶一切没理由的说教和唠叨，推崇使用最简单最有效的方法来解决最复杂的问题。天外飞仙，一剑封喉。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[搭建基于github的免费博客]]></title>
    <link href="http://stonelee.info/blog/2011/08/12/how-to-build-github-blog/"/>
    <updated>2011-08-12T00:00:00+08:00</updated>
    <id>http://stonelee.info/blog/2011/08/12/how-to-build-github-blog</id>
    <content type="html"><![CDATA[<h2>优势</h2>

<ul>
<li>国外著名开源网站，影响力大（无声无息倒掉的风险较少）</li>
<li>基于git的本地源码控制，安全（防GFW）</li>
<li>纯文本写作，适合程序控</li>
<li>可以绑定自己的域名</li>
<li>空间免费</li>
</ul>


<h2>使用</h2>

<ul>
<li>fork我的博客</li>
<li>git clone</li>
<li>修改一下页面代码，在_posts中写自己的博客</li>
<li>github page服务后台使用jekyll，为了在本地写作博客， 修改满意后再进行同步，自己安装jekyll是很有必要的。
然后可以在本地启动</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>jekyll --server
</span></code></pre></td></tr></table></div></figure>


<h2>功能增强</h2>

<ul>
<li>添加评论<a href="http://disqus.com">disqus</a></li>
<li><a href="http://www.google.com/intl/zh-CN/analytics/">Google Analytics</a></li>
<li>blog订阅:<a href="http://www.feedsky.com">FeedSky</a></li>
<li>社会化推荐:<a href="http://www.jiathis.com">JiaThis</a></li>
</ul>


<h2>绑定域名</h2>

<p>修改 A record并指向207.97.227.245</p>

<p>我在Godaddy买的域名，还没用就被封DNS了。更换Nameservers后成功访问。使用的是 <a href="https://www.dnspod.cn/">dnspod</a>,据说是国内最早提供免费智能DNS产品的网站，需要邮箱和手机验证。</p>

<h2>参考</h2>

<ul>
<li><a href="http://saberma.me/other/2010/09/20/saberma-github-page-blog-build-with-jekyll.html">saberma的使用心得</a></li>
<li><a href="http://pages.github.com/">官方pages简介</a></li>
<li><a href="https://github.com/mojombo/jekyll/wiki/sites">其他人的博客列表</a></li>
</ul>


<h4>模板引擎liquid,是模版使用的语法</h4>

<ul>
<li><a href="https://github.com/shopify/liquid/wiki/liquid-for-designers">用法</a></li>
<li><a href="https://github.com/mojombo/jekyll/wiki/liquid-extensions">扩展</a></li>
</ul>


<h3>textile</h3>

<ul>
<li><a href="http://redcloth.org/hobix.com/textile/">语法参考</a></li>
<li><a href="http://textile.thresholdstate.com/">练习</a></li>
</ul>


<h3>语法高亮支持语言</h3>

<p><a href="http://pygments.org/docs/lexers/">pygments</a></p>

<h3>模版网址</h3>

<p><a href="http://freehtml5templates.com">基于html5、css3的免费模板</a></p>

<h2>PS</h2>

<h3>2012-05-05更新</h3>

<p>jekyll安装:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>gem install jekyll 0.11.0
</span></code></pre></td></tr></table></div></figure>


<p>遇到问题：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Liquid error: undefined method <span class="sb">`</span>join’ <span class="k">for</span> <span class="c">#</span>
</span></code></pre></td></tr></table></div></figure>


<p>解决方法: liquid降级</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>gem uninstall liquid
</span><span class='line'><span class="nv">$ </span>gem install liquid -v 2.2.2
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[糅合Markdown和语法高亮，快速写作技术博客]]></title>
    <link href="http://stonelee.info/blog/2011/07/29/blog-with-markdown-and-highlight/"/>
    <updated>2011-07-29T00:00:00+08:00</updated>
    <id>http://stonelee.info/blog/2011/07/29/blog-with-markdown-and-highlight</id>
    <content type="html"><![CDATA[<p>之前博客在javaeye，不知道触犯了老大哪根神经，不声不响就给封了，现在来到CSDN，又正好赶上改版，好好的博客写完后格式乱七八糟。国内的其他博客商也都好不到哪里去，不知道什么时候就被封，算了，自己动手丰衣足食，自己搞个独立博客吧。</p>

<h2>要求</h2>

<p>代码写惯了，觉得可视化编辑器非常不靠谱，写代码花时间，写文档花时间，调格式更得花时间，而且不利于备份。因此要求纯文本，标记语言简单易学，实现代码高亮。</p>

<h2>技术选型</h2>

<ul>
<li>标记语言 Markdown</li>
<li>python封装库 python-markdown2</li>
<li>代码高亮工具 Javascript code prettifier</li>
</ul>


<h2>实现</h2>

<h3>1. markdown实现：</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">markdown2</span>
</span><span class='line'><span class="n">content</span><span class="o">=</span><span class="s">&quot;something&quot;</span>
</span><span class='line'><span class="n">markdown</span> <span class="o">=</span> <span class="n">markdown2</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>字符串content会按照markdown的语法生成相应的html标签，直接输出到页面上即可。</p>

<h3>2. Javascript code prettifier使用：</h3>

<p>引入js文件和选择的css模板</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;prettify.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'><span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;desert.css&quot;</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span> <span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>函数加载到页面中：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;prettify.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'><span class="nt">&lt;body</span> <span class="na">onload=</span><span class="s">&quot;prettyPrint(); &quot;</span><span class="nt">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>代码插入：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">&quot;width: 40em; display: inline-block&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;pre</span> <span class="na">class=</span><span class="s">&quot;prettyprint&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        somecode
</span><span class='line'>    <span class="nt">&lt;/pre&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>python-markdown2中已经实现了代码高亮，无奈语焉不详，而且语法也着实丑陋。本着“quick and dirty”的原则，直接定义</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<p>来包裹想高亮的代码，然后用replace来替换上面的div,pre标签。</p>

<p>实现如此简单~</p>

<h2>样例</h2>

<p><img src="http://stonelee.info/images/blog/markdown.gif" alt="" /></p>

<h2>源文件</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>标题
</span><span class='line'>====
</span><span class='line'>
</span><span class='line'>前言
</span><span class='line'>
</span><span class='line'>**目录**
</span><span class='line'>
</span><span class='line'>* 第一章
</span><span class='line'> * 第一节
</span><span class='line'> * 第二节
</span><span class='line'>* 第二章
</span><span class='line'>* 第三章
</span><span class='line'>
</span><span class='line'>第一章
</span><span class='line'>------
</span><span class='line'>
</span><span class='line'>**第一节**
</span><span class='line'>
</span><span class='line'>内容内容内容内容内容内容
</span><span class='line'>
</span><span class='line'>**第二节**
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;code&gt;</span>
</span><span class='line'>def hello()
</span><span class='line'>    print &quot;hello&quot;
</span><span class='line'><span class="nt">&lt;/code&gt;</span>
</span><span class='line'>
</span><span class='line'>第二章
</span><span class='line'>------
</span><span class='line'>
</span><span class='line'>内容内容内容内容内容内容
</span></code></pre></td></tr></table></div></figure>


<h2>附有用的网址</h2>

<p>Markdown</p>

<ul>
<li><a href="http://daringfireball.net/projects/markdown/basics">入门</a></li>
<li><a href="http://daringfireball.net/projects/markdown/syntax">语法参考</a></li>
<li><a href="http://daringfireball.net/projects/markdown/dingus">练习场</a>，熟练后直接使用这个</li>
<li><a href="https://github.com/trentm/python-markdown2">markdown解析程序</a></li>
</ul>


<p>代码高亮 Javascript code prettifier</p>

<ul>
<li><a href="http://google-code-prettify.googlecode.com/svn/trunk/README.html">入门</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LINQ流水线]]></title>
    <link href="http://stonelee.info/blog/2011/07/27/linq-example/"/>
    <updated>2011-07-27T00:00:00+08:00</updated>
    <id>http://stonelee.info/blog/2011/07/27/linq-example</id>
    <content type="html"><![CDATA[<p>linq帅呆了~这一刻函数编程附身</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="c1">//处理废票文本框中用户的输入</span>
</span><span class='line'><span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">getDirtyNumList</span><span class="p">(</span><span class="kt">int</span> <span class="n">startNum</span><span class="p">,</span> <span class="kt">int</span> <span class="n">endNum</span><span class="p">,</span> <span class="kt">string</span> <span class="n">txtDirtyNums</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">txtDirtyNums</span><span class="p">.</span><span class="n">Trim</span><span class="p">(</span><span class="k">new</span> <span class="kt">char</span><span class="p">[]</span> <span class="p">{</span> <span class="sc">&#39; &#39;</span><span class="p">,</span> <span class="sc">&#39;,&#39;</span><span class="p">,</span> <span class="sc">&#39;，&#39;</span> <span class="p">})</span><span class="c1">//去掉头尾的空格或者逗号</span>
</span><span class='line'>                        <span class="p">.</span><span class="n">Split</span><span class="p">(</span><span class="k">new</span> <span class="kt">char</span><span class="p">[]</span> <span class="p">{</span> <span class="sc">&#39;,&#39;</span><span class="p">,</span> <span class="sc">&#39;，&#39;</span> <span class="p">})</span><span class="c1">//将字符串分割为数组</span>
</span><span class='line'>                        <span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">key</span> <span class="p">=&gt;</span> <span class="n">Regex</span><span class="p">.</span><span class="n">IsMatch</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="err">@</span><span class="s">&quot;^\d+{1}quot;))//数字</span>
</span><span class='line'>                        <span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">key</span> <span class="p">=&gt;</span> <span class="n">Convert</span><span class="p">.</span><span class="n">ToInt32</span><span class="p">(</span><span class="n">key</span><span class="p">))</span><span class="c1">//转格式</span>
</span><span class='line'>                        <span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">key</span> <span class="p">=&gt;</span> <span class="n">key</span> <span class="p">&gt;=</span> <span class="n">startNum</span> <span class="p">&amp;&amp;</span> <span class="n">key</span> <span class="p">&lt;=</span> <span class="n">endNum</span><span class="p">)</span><span class="c1">//必须在范围内</span>
</span><span class='line'>                        <span class="p">.</span><span class="n">OrderBy</span><span class="p">(</span><span class="n">key</span> <span class="p">=&gt;</span> <span class="n">key</span><span class="p">)</span><span class="c1">//排序</span>
</span><span class='line'>                        <span class="p">.</span><span class="n">Distinct</span><span class="p">()</span><span class="c1">//去重复</span>
</span><span class='line'>                        <span class="p">.</span><span class="n">ToList</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Tornado模板机制分析]]></title>
    <link href="http://stonelee.info/blog/2011/07/26/tornado-template-analyse/"/>
    <updated>2011-07-26T00:00:00+08:00</updated>
    <id>http://stonelee.info/blog/2011/07/26/tornado-template-analyse</id>
    <content type="html"><![CDATA[<p>Tornado自带的模板系统非常有特色，相对django等框架来说，可以任意插入python语句，这对于前后台通吃的小团队和个人开发者来说非常方便，而且可以方便的从Tornado框架中剥离出来单独使用。下面简单研究一下模板的实现机制。</p>

<p>模板的实现集中在template.py中，之所以可以随意在模板文本中插入python语句，是因为代码运行时会直接将文本转成python代码。这是如何实现的呢？</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">exec</span> <span class="bp">self</span><span class="o">.</span><span class="n">compiled</span> <span class="ow">in</span> <span class="n">namespace</span>
</span></code></pre></td></tr></table></div></figure>


<p>exec是python的内置语句，其作用是动态执行python代码，第一个参数可以是string，可以是打开的file object，也可以是code object。可以使用in来引入环境变量。这句代码的意思就是在namespace所设定的环境变量中，执行self.compiled的代码。</p>

<p>那么self.compiled从何而来呢？</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="bp">self</span><span class="o">.</span><span class="n">compiled</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;exec&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>使用exec执行python字符串时，需要先用解释器将其编译为字节代码，为避免多次编译导致没必要的时间消耗，可以预先进行编译。</p>

<p>compile(source,filename,mode[,flags[,dont_inherit]])可以将字符串编译为字节代码，其中source是要被编译的字符串，filename是定义该字符串变量的文件，如果不需要的话推荐设置为<string>,mode指定编译类型（single指单个语句，exec指多个语句，eval指一个表达式）。</p>

<p>exec实际上会动态生成函数_execute()，而且将环境变量插入namespace中，这样就可以从namespace中再取出该函数，然后执行，其结果就是以python代码的方式完成模板文本的解析。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">execute</span> <span class="o">=</span> <span class="n">namespace</span><span class="p">[</span><span class="s">&quot;_execute&quot;</span><span class="p">]</span>
</span><span class='line'><span class="k">try</span><span class="p">:</span>
</span><span class='line'>     <span class="k">return</span> <span class="n">execute</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>那么self.code是怎么生成的呢？</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">reader</span> <span class="o">=</span> <span class="n">_TemplateReader</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">template_string</span><span class="p">)</span>
</span><span class='line'><span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="n">_File</span><span class="p">(</span><span class="n">_parse</span><span class="p">(</span><span class="n">reader</span><span class="p">))</span>
</span><span class='line'><span class="bp">self</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_python</span><span class="p">(</span><span class="n">loader</span><span class="p">,</span> <span class="n">compress_whitespace</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>详细代码可以参见template.py,纯粹是字符串的解析，有时间再看吧。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[DotNetBar中ComboTree显示整条路径信息]]></title>
    <link href="http://stonelee.info/blog/2011/07/22/dotnetbar-combotree-show-path/"/>
    <updated>2011-07-22T00:00:00+08:00</updated>
    <id>http://stonelee.info/blog/2011/07/22/dotnetbar-combotree-show-path</id>
    <content type="html"><![CDATA[<h2>背景</h2>

<p>ComboTree是个可以显示树状下拉菜单的ComboBox控件，弹出菜单如下所示：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Tree
</span><span class='line'>     — node
</span><span class='line'>     — node</span></code></pre></td></tr></table></div></figure>


<p>点击节点node，默认显示结果为node，即仅仅是节点信息。
现在需求是要显示Tree node，即返回整条路径信息。</p>

<h2>思路</h2>

<p>看上去很简单的样子，在选择事件中得到该节点的父路径信息，然后设置ComboTree的Text值即可。
嗯嗯！我擦！Text没用！！</p>

<h2>换个思路</h2>

<p>更改显示节点，即SelectedNode的Text，这下行了。ComboBox显示成功，但问题是原来节点的信息也被更改了，导致树变得很难看。没办法，在弹出菜单出现时再改回去，弹出菜单出现时改回来吧！真是个丑陋的做法！</p>

<p><img src="http://stonelee.info/images/blog/combobox.gif" alt="" /></p>

<h2>无代码无真相</h2>

<p>主要是用Tag来存储内部信息，没什么技术含量~</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="c1">//显示整个路径信息  </span>
</span><span class='line'><span class="k">private</span> <span class="k">void</span> <span class="nf">showFullText</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">string</span> <span class="n">strPaths</span> <span class="p">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="n">comboTreeDate</span><span class="p">.</span><span class="n">SelectedNode</span><span class="p">.</span><span class="n">FullPath</span><span class="p">.</span><span class="n">Split</span><span class="p">(</span><span class="sc">&#39;;&#39;</span><span class="p">).</span><span class="n">ToList</span><span class="p">().</span><span class="n">ForEach</span><span class="p">(</span><span class="n">s</span> <span class="p">=&gt;</span> <span class="n">strPaths</span> <span class="p">+=</span> <span class="n">s</span><span class="p">);</span>
</span><span class='line'>    <span class="n">Node</span> <span class="n">thisNode</span> <span class="p">=</span> <span class="n">comboTreeDate</span><span class="p">.</span><span class="n">SelectedNode</span><span class="p">;</span>
</span><span class='line'>    <span class="c1">//存储原值  </span>
</span><span class='line'>    <span class="n">comboTreeDate</span><span class="p">.</span><span class="n">Tag</span> <span class="p">=</span> <span class="n">thisNode</span><span class="p">;</span>
</span><span class='line'>    <span class="n">thisNode</span><span class="p">.</span><span class="n">Tag</span> <span class="p">=</span> <span class="n">thisNode</span><span class="p">.</span><span class="n">Text</span><span class="p">;</span>
</span><span class='line'>    <span class="c1">//更改text  </span>
</span><span class='line'>    <span class="n">thisNode</span><span class="p">.</span><span class="n">Text</span> <span class="p">=</span> <span class="n">strPaths</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">private</span> <span class="k">void</span> <span class="nf">comboTreeDate_PopupShowing</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//改回原值  </span>
</span><span class='line'>    <span class="n">Node</span> <span class="n">thisNode</span><span class="p">=</span> <span class="n">comboTreeDate</span><span class="p">.</span><span class="n">Tag</span> <span class="k">as</span> <span class="n">Node</span><span class="p">;</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">thisNode</span><span class="p">!=</span><span class="k">null</span><span class="p">)</span>
</span><span class='line'>        <span class="n">thisNode</span><span class="p">.</span><span class="n">Text</span> <span class="p">=</span> <span class="n">thisNode</span><span class="p">.</span><span class="n">Tag</span><span class="p">.</span><span class="n">ToString</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">private</span> <span class="k">void</span> <span class="nf">comboTreeDate_PopupClose</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">showFullText</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[连续票号剔除算法]]></title>
    <link href="http://stonelee.info/blog/2011/07/14/continue-bill-number-reject/"/>
    <updated>2011-07-14T00:00:00+08:00</updated>
    <id>http://stonelee.info/blog/2011/07/14/continue-bill-number-reject</id>
    <content type="html"><![CDATA[<h2>问题场景</h2>

<p>现有票据0-999，单位A领取前100张（0-99），单位B领取之后100张(100-199),单位C也领取100张(400-499),求剩下的票号段</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>原来： 0-999
</span><span class='line'>领取： 0-99 100-199 400-499
</span><span class='line'>===========运算求解======================
</span><span class='line'>剩余： 200-399 500-999</span></code></pre></td></tr></table></div></figure>


<h2>分析</h2>

<p>如果单纯分析这个问题，此时票据只有1000张，数量很少，因此只需要将每个票号放到一个set中，然后进行简单的集合运算即可求出结果。</p>

<p>但是现实系统中票据量往往很大(9位票据就是近10亿条记录)，每张票据一条记录进行存储是不现实的，因此需要进行分段存储，即将一次领取的几本票据（票号连续）作为一条记录，只记录起始票号和终止票号，运算时因为内存空间有限，也不能整体集合求解，需要另辟蹊径。</p>

<p>既然是边界条件判断，如果用各种if应该可以解决问题，但是这样太繁琐，非常容易出错。今天早上忽然想到，这个问题中票号是连续的，因此只要找到前后几个关键点，整段票号就能确定，而段内的票号是不重要的。</p>

<h2>算法</h2>

<p>1.找到全部关键点</p>

<p>原来的号：0 999</p>

<p>每段领取号各向外扩展一个号，作为可能的关键点：
-1 100 99 200 399 500</p>

<p>2.将上两种关键点放到一个数组中，去重复排序，得到：
-1 0 99 100 200 399 500 999</p>

<p>3.去掉领取号中重复的点，剩余：
-1 200 399 500 999</p>

<p>4.只取原来范围内的点，剩余
200 399 500 999</p>

<p>5.两两一组，即为所求解
(200,399),(500,999)</p>

<h2>c#技巧</h2>

<ul>
<li>HashSet可以去重复，也可使用Distinct</li>
<li>引入Linq后，数组可以进行集合运算。交集Intersect，差集Except，联集Union</li>
<li>数组只能存储相同类型的数据</li>
<li>二维数组和交错数组是不同的，二维数组形如int[,],GetLength(0)可获得第0维长度，依次类推</li>
<li>需要筛选操作的话，使用交错数组string[][]，而不要使用多维数组int[,]</li>
</ul>


<h2>无码无真相</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="c1">//从父表票号段中剔除子表中的票号段  </span>
</span><span class='line'><span class="k">public</span> <span class="k">static</span> <span class="kt">int</span><span class="p">[,]</span> <span class="n">getLeftNums</span><span class="p">(</span><span class="kt">int</span><span class="p">[,]</span> <span class="n">fathers</span><span class="p">,</span> <span class="kt">int</span><span class="p">[,]</span> <span class="n">sons</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//填入所有可能的关键点  </span>
</span><span class='line'>    <span class="c1">//HashSet可去重复  </span>
</span><span class='line'>    <span class="n">HashSet</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">possibleSets</span> <span class="p">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;();</span>
</span><span class='line'>    <span class="k">foreach</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="k">in</span> <span class="n">fathers</span><span class="p">)</span>
</span><span class='line'>        <span class="n">possibleSets</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">sons</span><span class="p">.</span><span class="n">GetLength</span><span class="p">(</span><span class="m">0</span><span class="p">);</span> <span class="n">i</span><span class="p">++)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">possibleSets</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">sons</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="m">0</span><span class="p">]</span> <span class="p">-</span> <span class="m">1</span><span class="p">);</span>
</span><span class='line'>        <span class="n">possibleSets</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">sons</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="m">1</span><span class="p">]</span> <span class="p">+</span> <span class="m">1</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//去掉sons中已经使用过的点  </span>
</span><span class='line'>    <span class="n">HashSet</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">sonSets</span> <span class="p">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;();</span>
</span><span class='line'>    <span class="k">foreach</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="k">in</span> <span class="n">sons</span><span class="p">)</span>
</span><span class='line'>        <span class="n">sonSets</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
</span><span class='line'>    <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">withoutSonsSets</span> <span class="p">=</span> <span class="n">possibleSets</span><span class="p">.</span><span class="n">Except</span><span class="p">(</span><span class="n">sonSets</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//只取fathers范围内的点  </span>
</span><span class='line'>    <span class="n">HashSet</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">inFatherSets</span> <span class="p">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;();</span>
</span><span class='line'>    <span class="k">foreach</span> <span class="p">(</span><span class="kt">int</span> <span class="k">value</span> <span class="k">in</span> <span class="n">withoutSonsSets</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">fathers</span><span class="p">.</span><span class="n">GetLength</span><span class="p">(</span><span class="m">0</span><span class="p">);</span> <span class="n">i</span><span class="p">++)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="k">value</span> <span class="p">&gt;=</span> <span class="n">fathers</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="m">0</span><span class="p">]</span> <span class="p">&amp;&amp;</span> <span class="k">value</span> <span class="p">&lt;=</span> <span class="n">fathers</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="m">1</span><span class="p">])</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>                <span class="n">inFatherSets</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">value</span><span class="p">);</span>
</span><span class='line'>                <span class="k">break</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//排序  </span>
</span><span class='line'>    <span class="n">List</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">sortedLists</span> <span class="p">=</span> <span class="n">inFatherSets</span><span class="p">.</span><span class="n">OrderBy</span><span class="p">(</span><span class="n">i</span> <span class="p">=&gt;</span> <span class="n">i</span><span class="p">).</span><span class="n">ToList</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;();</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//两两一组  </span>
</span><span class='line'>    <span class="kt">int</span><span class="p">[,]</span> <span class="n">results</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="n">sortedLists</span><span class="p">.</span><span class="n">Count</span><span class="p">()</span> <span class="p">/</span> <span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">];</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">sortedLists</span><span class="p">.</span><span class="n">Count</span><span class="p">();</span> <span class="n">i</span><span class="p">++)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="kt">int</span> <span class="n">index</span> <span class="p">=</span> <span class="n">i</span> <span class="p">/</span> <span class="m">2</span><span class="p">;</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="p">%</span> <span class="m">2</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
</span><span class='line'>            <span class="n">results</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="m">0</span><span class="p">]</span> <span class="p">=</span> <span class="n">sortedLists</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span><span class='line'>        <span class="k">else</span>
</span><span class='line'>            <span class="n">results</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="m">1</span><span class="p">]</span> <span class="p">=</span> <span class="n">sortedLists</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">results</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>测试用例</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="na">[Test]</span>
</span><span class='line'><span class="k">public</span> <span class="k">void</span> <span class="nf">getLeftNum2</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">int</span><span class="p">[,]</span> <span class="n">fathers</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">]</span> <span class="p">{</span> <span class="p">{</span> <span class="m">0</span><span class="p">,</span> <span class="m">999</span> <span class="p">}</span> <span class="p">};</span>
</span><span class='line'>    <span class="kt">int</span><span class="p">[,]</span> <span class="n">sons</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="m">3</span><span class="p">,</span> <span class="m">2</span><span class="p">]</span> <span class="p">{</span> <span class="p">{</span> <span class="m">0</span><span class="p">,</span> <span class="m">99</span> <span class="p">},</span> <span class="p">{</span> <span class="m">100</span><span class="p">,</span> <span class="m">199</span> <span class="p">},</span> <span class="p">{</span> <span class="m">400</span><span class="p">,</span> <span class="m">499</span> <span class="p">}</span> <span class="p">};</span>
</span><span class='line'>    <span class="kt">int</span><span class="p">[,]</span> <span class="n">results</span> <span class="p">=</span> <span class="n">frmQueryBillDistribute</span><span class="p">.</span><span class="n">getLeftNums</span><span class="p">(</span><span class="n">fathers</span><span class="p">,</span> <span class="n">sons</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">int</span><span class="p">[,]</span> <span class="n">asserts</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">]</span> <span class="p">{</span> <span class="p">{</span> <span class="m">200</span><span class="p">,</span> <span class="m">399</span> <span class="p">},</span> <span class="p">{</span> <span class="m">500</span><span class="p">,</span> <span class="m">999</span> <span class="p">}};</span>
</span><span class='line'>    <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">asserts</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LINQ技巧小结]]></title>
    <link href="http://stonelee.info/blog/2011/06/27/linq-trick/"/>
    <updated>2011-06-27T00:00:00+08:00</updated>
    <id>http://stonelee.info/blog/2011/06/27/linq-trick</id>
    <content type="html"><![CDATA[<p>LINQ可不是简单的SQL语句的替代品，它将繁琐的数据操作（排序、求和、分组、投影、打包）统一起来，极大地简化了代码。</p>

<h2>查询所有以ABC开头的字符串</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="kt">string</span><span class="p">[]</span> <span class="n">xx</span><span class="p">={</span><span class="s">&quot;ABCEFG&quot;</span><span class="p">,</span><span class="s">&quot;ABCASDFASDF&quot;</span><span class="p">,</span><span class="s">&quot;12312ADSFASD&quot;</span><span class="p">};</span>
</span><span class='line'><span class="n">xx</span><span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">x</span><span class="p">=&gt;</span><span class="n">x</span><span class="p">.</span><span class="n">StartsWith</span><span class="p">(</span><span class="s">&quot;ABC&quot;</span><span class="p">)).</span><span class="n">ToList</span><span class="p">()</span>
</span><span class='line'>  <span class="p">.</span><span class="n">ForEach</span><span class="p">(</span><span class="n">x</span><span class="p">=&gt;</span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">x</span><span class="p">));</span>
</span></code></pre></td></tr></table></div></figure>


<p>使用正则来解决</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="kt">string</span><span class="p">[]</span> <span class="n">xx</span> <span class="p">=</span> <span class="p">{</span> <span class="s">&quot;ABCEFG&quot;</span><span class="p">,</span> <span class="s">&quot;abcASDFASDF&quot;</span><span class="p">,</span> <span class="s">&quot;12312ADSFASD&quot;</span> <span class="p">};</span>
</span><span class='line'><span class="n">xx</span><span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">s</span> <span class="p">=&gt;</span> <span class="n">Regex</span><span class="p">.</span><span class="n">IsMatch</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">&quot;^abc&quot;</span><span class="p">,</span><span class="n">RegexOptions</span><span class="p">.</span><span class="n">IgnoreCase</span><span class="p">))</span>
</span><span class='line'>  <span class="p">.</span><span class="n">ToList</span><span class="p">().</span><span class="n">ForEach</span><span class="p">(</span><span class="n">s</span> <span class="p">=&gt;</span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">s</span><span class="p">));</span>
</span></code></pre></td></tr></table></div></figure>


<h2>简化字符</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="kt">string</span> <span class="n">source</span> <span class="p">=</span> <span class="s">@&quot;西瓜,1,a</span>
</span><span class='line'><span class="s">苹果,2,b</span>
</span><span class='line'><span class="s">橙子,3,c&quot;</span><span class="p">;</span>
</span><span class='line'><span class="err">结果数组：西瓜</span><span class="p">,</span><span class="err">苹果</span><span class="p">,</span><span class="err">橙子</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="kt">string</span><span class="p">[]</span> <span class="n">array1</span> <span class="p">=</span> <span class="n">source</span><span class="p">.</span><span class="n">Split</span><span class="p">(</span><span class="k">new</span> <span class="kt">char</span><span class="p">[]</span> <span class="p">{</span> <span class="err">&#39;</span><span class="p">/</span><span class="n">r</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="p">/</span><span class="n">n</span><span class="err">&#39;</span> <span class="p">})</span>
</span><span class='line'>                  <span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Split</span><span class="p">(</span><span class="sc">&#39;,&#39;</span><span class="p">)[</span><span class="m">0</span><span class="p">]).</span><span class="n">ToArray</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LINQ方式实现学生成绩汇总（右连接、聚合函数）]]></title>
    <link href="http://stonelee.info/blog/2011/06/27/linq-score-collect/"/>
    <updated>2011-06-27T00:00:00+08:00</updated>
    <id>http://stonelee.info/blog/2011/06/27/linq-score-collect</id>
    <content type="html"><![CDATA[<h2>需求</h2>

<p>从数据表students中取得所有学生姓名，然后将其scores表对应中的分数相加，显示一个“姓名：分数”的列表</p>

<ul>
<li>取得所有姓名（包括没有成绩的）</li>
<li>分数是该学生所有成绩的总和</li>
</ul>


<p>先看效果图：</p>

<p><img src="http://stonelee.info/images/blog/score.gif" alt="" /></p>

<p>数据库结构简化模拟如下：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="k">class</span> <span class="nc">Student</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">int</span> <span class="n">id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">string</span> <span class="n">name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Score</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">int</span> <span class="n">StudentId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">int</span> <span class="n">score</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>插入测试数据：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="n">Student</span> <span class="n">p1</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Student</span><span class="p">()</span> <span class="p">{</span> <span class="n">id</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">name</span> <span class="p">=</span> <span class="s">&quot;张三&quot;</span> <span class="p">};</span>
</span><span class='line'><span class="n">Student</span> <span class="n">p2</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Student</span><span class="p">()</span> <span class="p">{</span> <span class="n">id</span> <span class="p">=</span> <span class="m">2</span><span class="p">,</span> <span class="n">name</span> <span class="p">=</span> <span class="s">&quot;李四&quot;</span> <span class="p">};</span>
</span><span class='line'><span class="n">Student</span> <span class="n">p3</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Student</span><span class="p">()</span> <span class="p">{</span> <span class="n">id</span> <span class="p">=</span> <span class="m">3</span><span class="p">,</span> <span class="n">name</span> <span class="p">=</span> <span class="s">&quot;王五&quot;</span> <span class="p">};</span>
</span><span class='line'><span class="n">Score</span> <span class="n">s1</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Score</span><span class="p">()</span> <span class="p">{</span> <span class="n">StudentId</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">score</span> <span class="p">=</span> <span class="m">80</span> <span class="p">};</span>
</span><span class='line'><span class="n">Score</span> <span class="n">s2</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Score</span><span class="p">()</span> <span class="p">{</span> <span class="n">StudentId</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">score</span> <span class="p">=</span> <span class="m">90</span> <span class="p">};</span>
</span><span class='line'><span class="n">Score</span> <span class="n">s3</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Score</span><span class="p">()</span> <span class="p">{</span> <span class="n">StudentId</span> <span class="p">=</span> <span class="m">2</span><span class="p">,</span> <span class="n">score</span> <span class="p">=</span> <span class="m">70</span> <span class="p">};</span>
</span><span class='line'><span class="n">List</span><span class="p">&lt;</span><span class="n">Student</span><span class="p">&gt;</span> <span class="n">students</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Student</span><span class="p">&gt;(</span><span class="k">new</span> <span class="n">Student</span><span class="p">[]</span> <span class="p">{</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span> <span class="p">});</span>
</span><span class='line'><span class="n">List</span><span class="p">&lt;</span><span class="n">Score</span><span class="p">&gt;</span> <span class="n">scores</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Score</span><span class="p">&gt;(</span><span class="k">new</span> <span class="n">Score</span><span class="p">[]</span> <span class="p">{</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">s3</span> <span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>查询，注意：</p>

<ul>
<li>LINQ中没有left join和right join之分，只有关键词join来控制连接，join之前表的作为完整的表连接，join之后的表需要使用DefaultIfEmpty来进行处理，才能正常的显示null值</li>
<li>group中的key是分组的字段，分组后就可以使用聚合函数了</li>
<li>LINQ就像生产流水线，可以分阶段进行数据排序、汇总、投影等操作，最后组装起来就能达到预定的效果</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="c1">//left join,返回左边每一个元素  </span>
</span><span class='line'><span class="n">var</span> <span class="n">studentsTable</span> <span class="p">=</span> <span class="n">from</span> <span class="n">student</span> <span class="k">in</span> <span class="n">students</span>
</span><span class='line'>                    <span class="n">join</span> <span class="n">score</span> <span class="k">in</span> <span class="n">scores</span> <span class="n">on</span> <span class="n">student</span><span class="p">.</span><span class="n">id</span> <span class="n">equals</span> <span class="n">score</span><span class="p">.</span><span class="n">StudentId</span> <span class="n">into</span> <span class="n">joinedTable</span>
</span><span class='line'>                    <span class="n">from</span> <span class="n">j</span> <span class="k">in</span> <span class="n">joinedTable</span><span class="p">.</span><span class="n">DefaultIfEmpty</span><span class="p">()</span><span class="c1">//处理右边为空的情况  </span>
</span><span class='line'>                    <span class="n">select</span> <span class="k">new</span>
</span><span class='line'>                    <span class="p">{</span>
</span><span class='line'>                        <span class="n">name</span> <span class="p">=</span> <span class="n">student</span><span class="p">.</span><span class="n">name</span><span class="p">,</span>
</span><span class='line'>                        <span class="n">score</span> <span class="p">=</span> <span class="n">j</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">?</span> <span class="n">j</span><span class="p">.</span><span class="n">score</span> <span class="p">:</span> <span class="m">0</span>
</span><span class='line'>                    <span class="p">};</span>
</span><span class='line'><span class="c1">//聚合函数  </span>
</span><span class='line'><span class="n">var</span> <span class="n">data</span> <span class="p">=</span> <span class="n">from</span> <span class="n">student</span> <span class="k">in</span> <span class="n">studentsTable</span>
</span><span class='line'>           <span class="n">group</span> <span class="n">student</span> <span class="n">by</span> <span class="n">student</span><span class="p">.</span><span class="n">name</span> <span class="n">into</span> <span class="n">g</span>
</span><span class='line'>           <span class="n">select</span> <span class="k">new</span>
</span><span class='line'>           <span class="p">{</span>
</span><span class='line'>               <span class="n">name</span> <span class="p">=</span> <span class="n">g</span><span class="p">.</span><span class="n">Key</span><span class="p">,</span>
</span><span class='line'>               <span class="n">score</span> <span class="p">=</span> <span class="n">g</span><span class="p">.</span><span class="n">Sum</span><span class="p">(</span><span class="n">student</span> <span class="p">=&gt;</span> <span class="n">student</span><span class="p">.</span><span class="n">score</span><span class="p">)</span>
</span><span class='line'>           <span class="p">};</span>
</span><span class='line'><span class="k">foreach</span> <span class="p">(</span><span class="n">var</span> <span class="n">d</span> <span class="k">in</span> <span class="n">data</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;name:&quot;</span> <span class="p">+</span> <span class="n">d</span><span class="p">.</span><span class="n">name</span> <span class="p">+</span> <span class="s">&quot;;score:&quot;</span> <span class="p">+</span> <span class="n">d</span><span class="p">.</span><span class="n">score</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="n">Console</span><span class="p">.</span><span class="n">ReadLine</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>


<p>看看效果：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="k">foreach</span> <span class="p">(</span><span class="n">var</span> <span class="n">d</span> <span class="k">in</span> <span class="n">data</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;name:&quot;</span> <span class="p">+</span> <span class="n">d</span><span class="p">.</span><span class="n">name</span> <span class="p">+</span> <span class="s">&quot;;score:&quot;</span> <span class="p">+</span> <span class="n">d</span><span class="p">.</span><span class="n">score</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="n">Console</span><span class="p">.</span><span class="n">ReadLine</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[数据抓包及分析经验小结]]></title>
    <link href="http://stonelee.info/blog/2011/04/08/data-scratch-and-analysis/"/>
    <updated>2011-04-08T00:00:00+08:00</updated>
    <id>http://stonelee.info/blog/2011/04/08/data-scratch-and-analysis</id>
    <content type="html"><![CDATA[<ul>
<li>分析网络包——Wireshark</li>
<li>查看AMF数据结构工具——AMF Explorer</li>
<li>查看cookie工具——Firecookie</li>
<li>cookie操作</li>
<li>cookie分析</li>
</ul>


<h2>1.分析网络包——Wireshark</h2>

<ul>
<li>ubuntu下需要sudo wireshark启动</li>
<li>Capture-interfaces:Start有ip的Device</li>
<li>本机网络包无法抓取</li>
<li>filter中填写:

<ul>
<li>http and ip.src==192.168.1.103只显示本机发送的http协议包</li>
<li>http and ip.addr==192.168.1.103只显示本机发送和接收的http协议包</li>
</ul>
</li>
</ul>


<h2>2.查看AMF数据结构工具——AMF Explorer</h2>

<p>AMF Explorer基于Firebug的AMF查看插件</p>

<h2>3.查看cookie工具——Firecookie</h2>

<p>Firecookie基于Firebug的cookie查看、删除修改等操作插件，还可以下断点</p>

<h2>4.cookie操作</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">urllib2</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">cookielib</span>
</span><span class='line'><span class="c">#自动记录cookie</span>
</span><span class='line'><span class="n">cj</span> <span class="o">=</span> <span class="n">cookielib</span><span class="o">.</span><span class="n">CookieJar</span><span class="p">()</span>
</span><span class='line'><span class="n">opener</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">build_opener</span><span class="p">(</span><span class="n">urllib2</span><span class="o">.</span><span class="n">HTTPCookieProcessor</span><span class="p">(</span><span class="n">cj</span><span class="p">))</span>
</span><span class='line'><span class="n">request</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="s">&#39;http://www.pythonchallenge.com/pc/def/linkedlist.php?busynothing=12345&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">response</span> <span class="o">=</span> <span class="n">opener</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c">#获取服务器返回的cookie</span>
</span><span class='line'><span class="n">cookies</span> <span class="o">=</span> <span class="n">cj</span><span class="o">.</span><span class="n">make_cookies</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span> <span class="c"># extract all cookies that this request-response pair added to the jar</span>
</span><span class='line'>
</span><span class='line'><span class="c">#修改cookie</span>
</span><span class='line'><span class="n">cookie</span> <span class="o">=</span> <span class="n">cookies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'><span class="n">cookie</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#39;the flowers are on their way&#39;</span> <span class="c"># 将其值设为要发送的，不必自己转码</span>
</span><span class='line'><span class="n">request</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="s">&#39;http://www.pythonchallenge.com/pc/stuff/violin.php&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">cj</span><span class="o">.</span><span class="n">set_cookie</span><span class="p">(</span><span class="n">cookie</span><span class="p">)</span>
</span><span class='line'><span class="n">cj</span><span class="o">.</span><span class="n">add_cookie_header</span><span class="p">(</span><span class="n">request</span><span class="p">)</span> <span class="c">#将cookies放入请求头部</span>
</span><span class='line'><span class="k">print</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">request</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<h2>5.cookie分析</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>Connection   keep-alive
</span></code></pre></td></tr></table></div></figure>


<p>说明使用的是长连接，应该使用Httplib2而不是Urllib2</p>

<p>网站登录信息往往保存在基于session的cookie里，因此在发送数据包的时候提供</p>

<p>服务端Response Headers   set-cookie发送给客户端cookie然后</p>

<p>客户端Request Headers    Cookie才能保存</p>
]]></content>
  </entry>
  
</feed>
