
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Stonelee's Blog</title>
  <meta name="author" content="stonelee">

  
  <meta name="description" content="基本都是直接复制到bundle，然后添加doc帮助 1
：helptags ~/.vim/bundle/something/doc pathogen 将插件按文件夹放置，方便管理 将pathogen放到autoload下 .vimrc: 1
2
3
filetype off
call &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://stonelee.info/blog/page/5">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Stonelee's Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-20312823-3']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Stonelee's Blog</a></h1>
  
    <h2>如无必要，勿增实体</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:stonelee.info" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/projects">Projects</a></li>
  <li><a href="/notes/_build/html/index.html">Notes</a></li>
  <li><a href="/records/index.html">Records</a></li>
  <li><a href="/about">About Me</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/01/09/vim-plugin/">Vim最佳插件实践</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-01-09T00:00:00+08:00" pubdate data-updated="true">2011-01-09</time>
        
      </p>
    

<style type="text/css" media="screen">
  .jiathis .flash-video{
    border: 0;
  }
</style>
    <div class="jiathis">
<!-- JiaThis Button BEGIN -->
<div id="ckepop">
	<span class="jiathis_txt">分享到：</span>
	<a class="jiathis_button_tools_1"></a>
	<a class="jiathis_button_tools_2"></a>
	<a class="jiathis_button_tools_3"></a>
	<a class="jiathis_button_tools_4"></a>
	<a href="http://www.jiathis.com/share?uid=1532263" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
</div>
<script type="text/javascript">var jiathis_config = {data_track_clickback:true};</script>
<script type="text/javascript" src="http://v2.jiathis.com/code/jia.js?uid=1532263" charset="utf-8"></script>
<!-- JiaThis Button END -->
    </div>
  </header>


  <div class="entry-content"><p>基本都是直接复制到bundle，然后添加doc帮助</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>：helptags ~/.vim/bundle/something/doc</span></code></pre></td></tr></table></div></figure>


<h2><a href="http://www.vim.org/scripts/script.php?script_id=2332">pathogen</a> 将插件按文件夹放置，方便管理</h2>

<p>将pathogen放到autoload下</p>

<p>.vimrc:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'><span class="k">filetype</span> off
</span><span class='line'><span class="k">call</span> pathogen#runtime_append_all_bundles<span class="p">()</span>&quot;方便管理plugin
</span><span class='line'><span class="k">filetype</span> plugin indent <span class="k">on</span>
</span></code></pre></td></tr></table></div></figure>


<h2><a href="http://www.vim.org/scripts/script.php?script_id=790">python增强语法高亮</a></h2>

<h2><a href="http://www.vim.org/scripts/script.php?script_id=30">python增强编辑</a></h2>

<p>会提供一个python菜单，快捷键也相应提供了</p>

<h2><a href="http://www.vim.org/scripts/script.php?script_id=159">minibufexpl</a>多标签切换</h2>

<p>.vimrc:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'><span class="c">&quot;&lt;C-hjkl&gt;minibuffer中移动</span>
</span><span class='line'><span class="k">let</span> g:miniBufExplMapWindowNavVim <span class="p">=</span> <span class="m">1</span>
</span><span class='line'><span class="c">&quot;&lt;C-TAB&gt; and &lt;C-S-TAB&gt; 直接在当前窗口切换buffer</span>
</span><span class='line'><span class="k">let</span> g:miniBufExplMapCTabSwitchBufs <span class="p">=</span> <span class="m">1</span>
</span><span class='line'><span class="c">&quot;防止与Taglist冲突</span>
</span><span class='line'><span class="k">let</span> g:miniBufExplModSelTarget <span class="p">=</span> <span class="m">1</span>
</span></code></pre></td></tr></table></div></figure>


<h2><a href="http://www.vim.org/scripts/script.php?script_id=1218">NERDCommenter</a>自动注释</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'><span class="p">&lt;</span>leader<span class="p">&gt;</span><span class="k">c</span><span class="p">&lt;</span>space<span class="p">&gt;</span>来切换注释与否
</span></code></pre></td></tr></table></div></figure>


<h2><a href="http://www.vim.org/scripts/script.php?script_id=1658">NERDTree</a>树状菜单</h2>

<p>.vimrc:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'>map <span class="p">&lt;</span>leader<span class="p">&gt;</span><span class="k">e</span> :NERDTreeToggle<span class="p">&lt;</span><span class="k">cr</span><span class="p">&gt;</span>
</span><span class='line'><span class="k">let</span> NERDTreeIgnore<span class="p">=</span>[<span class="s1">&#39;.vim$&#39;</span><span class="p">,</span> <span class="s1">&#39;\~$&#39;</span><span class="p">,</span> <span class="s1">&#39;.*\.pyc$&#39;</span><span class="p">,</span> <span class="s1">&#39;pip-log\.txt$&#39;</span>]
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'><span class="p">&lt;</span>leader<span class="p">&gt;</span><span class="k">e</span>来切换树形菜单显示与否
</span></code></pre></td></tr></table></div></figure>


<h2><a href="http://code.google.com/p/xptemplate/">xptemplate</a> Snippet Template engine</h2>

<p>支持嵌套，支持同文件多模板识别</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'><span class="p">&lt;</span>C<span class="p">-</span>\<span class="p">&gt;</span>显示模板，<span class="p">&lt;</span>Tab<span class="p">&gt;&lt;</span>S<span class="p">-</span>Tab<span class="p">&gt;</span>切换焦点
</span></code></pre></td></tr></table></div></figure>


<p>自己更改模板：
ftplugin下找到对应模板文件，添加新的模板</p>

<p>去掉多余空格：
.vimrc:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'><span class="k">let</span> g:xptemplate_vars <span class="p">=</span> <span class="c">&quot;SParg=&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Ack 目录文件中查找字符</h2>

<p>安装Ack:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo apt-get install ack-grep
</span></code></pre></td></tr></table></div></figure>


<p>安装 <a href="https://github.com/mileszs/ack.vim">Ack</a>插件
.vimrc:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'><span class="k">let</span> g:ackprg<span class="p">=</span><span class="s2">&quot;ack-grep -H --nocolor --nogroup --column&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ack something可以在当前目录查找字符</p>

<h2><a href="http://www.vim.org/scripts/script.php?script_id=2981">zencoding</a>扩展html</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'><span class="p">&lt;</span>C<span class="p">-</span><span class="k">y</span><span class="p">&gt;,</span> 扩展
</span><span class='line'><span class="p">&lt;</span>C<span class="p">-</span><span class="k">y</span><span class="p">&gt;</span><span class="k">n</span> <span class="p">&lt;</span>C<span class="p">-</span><span class="k">y</span><span class="p">&gt;</span><span class="k">N</span> 到下/上一个输入点
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span>C<span class="p">-</span><span class="k">y</span><span class="p">&gt;</span><span class="k">d</span> <span class="p">&lt;</span>C<span class="p">-</span><span class="k">y</span><span class="p">&gt;</span> D选中
</span><span class='line'><span class="p">&lt;</span>C<span class="p">-</span><span class="k">y</span><span class="p">&gt;</span><span class="k">j</span> 简写标签，也可扩展
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span>C<span class="p">-</span><span class="k">y</span><span class="p">&gt;</span>i img上使用可以自动添加宽高
</span><span class='line'><span class="p">&lt;</span>C<span class="p">-</span><span class="k">y</span><span class="p">&gt;</span>a 在连接上可以添加a标签
</span></code></pre></td></tr></table></div></figure>


<h2><a href="http://www.vim.org/scripts/script.php?script_id=1234">YankRing</a>增强型粘贴</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'><span class="p">:</span>YRShow显示剪贴板
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span>C<span class="p">-</span><span class="k">p</span><span class="p">&gt;</span> <span class="p">&lt;</span>C<span class="p">-</span><span class="k">n</span><span class="p">&gt;</span> 轮番切换剪贴板
</span></code></pre></td></tr></table></div></figure>


<h2><a href="http://www.vim.org/scripts/script.php?script_id=2996">translate</a></h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'><span class="p">:</span>Trans翻译光标所在文字
</span></code></pre></td></tr></table></div></figure>


<h2><a href="http://www.vim.org/scripts/script.php?script_id=1697">surround</a>增删改标签</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'><span class="k">ds</span>“ 删除两端的”“
</span><span class='line'>dst 删除两端的标签
</span><span class='line'>cs”{ 将两端的“”改为{  } 有空格
</span><span class='line'>cs”} 将两端的“”改为{} 无空格
</span><span class='line'>yss<span class="p">)</span> 两端加上<span class="p">()</span>
</span><span class='line'>ysiw） 将光标所在单词两端加上（）
</span><span class='line'>配合repeat实现.重复操作
</span></code></pre></td></tr></table></div></figure>


<h2><a href="https://github.com/jpalardy/dotfiles/raw/master/vim/plugin/slime.vim">slime</a>测试代码段</h2>

<p>终端中建立一个screen</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>screen -S devshell
</span><span class='line'>python
</span><span class='line'>
</span><span class='line'>选中代码，&lt;C-c&gt;&lt;C-c&gt;可以在screen中查看运行情况。
</span></code></pre></td></tr></table></div></figure>


<p>screen的使用可以参看：
http://hi.baidu.com/ubuntu2me/blog/item/ce61b23798a5a93b0b55a960.html
http://wiki.ubuntu.org.cn/GNUScreen
http://www.9usb.net/201002/linux-screen-mingling.html</p>

<h2><a href="http://www.vim.org/scripts/script.php?script_id=2914">pep8</a>代码静态检查</h2>

<p>需要先安装工具 &#8220;pep8&#8221;:http://github.com/cburroughs/pep8.py
F5 安装pep8规则检查代码</p>

<h2><a href="http://www.vim.org/scripts/script.php?script_id=2527">jpythonfold</a>代码折叠</h2>

<p>需要重命名为python.vim
.vimrc中：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'>nnoremap <span class="p">&lt;</span>space<span class="p">&gt;</span> za
</span></code></pre></td></tr></table></div></figure>


<p>空格 折叠、打开代码段
zr 打开所有折叠
zm 所有折叠</p>

<p>js代码折叠</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'><span class="k">let</span> javaScript_fold<span class="p">=</span><span class="m">1</span>
</span></code></pre></td></tr></table></div></figure>


<h2><a href="http://ctags.sourceforge.net/">ctags</a>+ <a href="http://www.vim.org/scripts/script.php?script_id=273">taglist</a>展示代码结构</h2>

<p>安装ctags，在要生成tags的目录下ctags -R
安装taglist插件</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'><span class="p">:</span>TlistToggle切换<span class="k">tags</span>显示与否
</span></code></pre></td></tr></table></div></figure>


<h2><a href="http://www.vim.org/scripts/script.php?script_id=2607">tasklist</a>显示todo列表</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'><span class="p">&lt;</span>leader<span class="p">&gt;</span><span class="k">t</span> 打开todo列表
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/12/24/mark-time-to-plant-and-build/">盖房子种树记好时间</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-12-24T00:00:00+08:00" pubdate data-updated="true">2010-12-24</time>
        
      </p>
    

<style type="text/css" media="screen">
  .jiathis .flash-video{
    border: 0;
  }
</style>
    <div class="jiathis">
<!-- JiaThis Button BEGIN -->
<div id="ckepop">
	<span class="jiathis_txt">分享到：</span>
	<a class="jiathis_button_tools_1"></a>
	<a class="jiathis_button_tools_2"></a>
	<a class="jiathis_button_tools_3"></a>
	<a class="jiathis_button_tools_4"></a>
	<a href="http://www.jiathis.com/share?uid=1532263" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
</div>
<script type="text/javascript">var jiathis_config = {data_track_clickback:true};</script>
<script type="text/javascript" src="http://v2.jiathis.com/code/jia.js?uid=1532263" charset="utf-8"></script>
<!-- JiaThis Button END -->
    </div>
  </header>


  <div class="entry-content"><h2>问题描述</h2>

<p>设想以下场景：盖个房子，房子需要m秒才能盖好；然后种了棵树，树需要n秒才能长好。盖房子、种树等行为都是连续的操作，手动即可，不能间断，而时间的存储一般人是需要存到脑子中，或者记到笔记本上，或者定个闹钟。时间到后再进行相应的处理。</p>

<h2>解决方案</h2>

<p>模拟人的行为：手动操作作为主线程顺序执行，需要存储时间时开启新的一个线程来保存时间并计时（也就是说两者需要做到异步）。仅仅存储时间是不够的，还需要将该时间所对应的状态信息保存下来，以供时间到后的下步操作。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/env python</span>
</span><span class='line'><span class="c"># -*- coding: utf-8 -*-</span>
</span><span class='line'><span class="c"># Last Update:</span>
</span><span class='line'>
</span><span class='line'><span class="n">__revision__</span> <span class="o">=</span> <span class="s">&#39;0.1&#39;</span>
</span><span class='line'><span class="n">__author__</span> <span class="o">=</span> <span class="s">&#39;lxd&#39;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">threading</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">time</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">TimeThread</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">):</span>
</span><span class='line'>    <span class="sd">&quot;&quot;&quot;等待线程</span>
</span><span class='line'><span class="sd">    &quot;&quot;&quot;</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">seconds</span><span class="p">):</span>
</span><span class='line'>        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">seconds</span> <span class="o">=</span> <span class="n">seconds</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seconds</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">TimeWorks</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">wait_works</span> <span class="o">=</span> <span class="p">{}</span><span class="c">#等待工作列表，包括工作的所有细节</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">wait_times_threads</span> <span class="o">=</span> <span class="p">[]</span><span class="c">#线程列表</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">setTime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">seconds</span><span class="p">):</span>
</span><span class='line'>        <span class="sd">&quot;&quot;&quot;将data放入等待工作列表中，并将工作放入线程中等待</span>
</span><span class='line'><span class="sd">        name如果已存在，则会覆盖原来的</span>
</span><span class='line'><span class="sd">        &quot;&quot;&quot;</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">wait_works</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">name</span><span class="p">:</span><span class="n">data</span><span class="p">})</span>
</span><span class='line'>        <span class="n">atime</span> <span class="o">=</span> <span class="n">TimeThread</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">seconds</span><span class="p">)</span>
</span><span class='line'>        <span class="n">atime</span><span class="o">.</span><span class="n">setDaemon</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>        <span class="n">atime</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">wait_times_threads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atime</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">checkTimeThread</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="sd">&quot;&quot;&quot;获得时间已到的工作</span>
</span><span class='line'><span class="sd">        &quot;&quot;&quot;</span>
</span><span class='line'>        <span class="k">for</span> <span class="n">atime</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_times_threads</span><span class="p">:</span>
</span><span class='line'>            <span class="k">if</span> <span class="ow">not</span> <span class="n">atime</span><span class="o">.</span><span class="n">isAlive</span><span class="p">():</span>
</span><span class='line'>                <span class="bp">self</span><span class="o">.</span><span class="n">wait_times_threads</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">atime</span><span class="p">)</span>
</span><span class='line'>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_works</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">atime</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
</span><span class='line'>    <span class="k">print</span> <span class="s">&#39;start&#39;</span>
</span><span class='line'>    <span class="n">timeWorks</span> <span class="o">=</span> <span class="n">TimeWorks</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">build</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;kind&#39;</span><span class="p">:</span><span class="s">&#39;build&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span><span class="s">&#39;build1&#39;</span><span class="p">,</span> <span class="s">&#39;pos&#39;</span><span class="p">:(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)}</span>
</span><span class='line'>    <span class="n">timeWorks</span><span class="o">.</span><span class="n">setTime</span><span class="p">(</span><span class="s">&#39;build1&#39;</span><span class="p">,</span> <span class="n">build</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">farm</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;kind&#39;</span><span class="p">:</span><span class="s">&#39;farm&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span><span class="s">&#39;tom&#39;</span><span class="p">,</span> <span class="s">&#39;pos&#39;</span><span class="p">:(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)}</span>
</span><span class='line'>    <span class="n">timeWorks</span><span class="o">.</span><span class="n">setTime</span><span class="p">(</span><span class="s">&#39;farm1&#39;</span><span class="p">,</span> <span class="n">farm</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">build_something</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span><span class='line'>        <span class="k">print</span> <span class="s">&#39;build_something&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">farm_something</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span><span class='line'>        <span class="k">print</span> <span class="s">&#39;farm_something&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
</span><span class='line'>        <span class="k">print</span> <span class="s">&#39;do_something&#39;</span><span class="p">,</span> <span class="n">i</span>
</span><span class='line'>        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">data</span> <span class="o">=</span> <span class="n">timeWorks</span><span class="o">.</span><span class="n">checkTimeThread</span><span class="p">()</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
</span><span class='line'>            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;kind&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;build&#39;</span><span class="p">:</span>
</span><span class='line'>                <span class="n">build_something</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span class='line'>            <span class="k">elif</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;kind&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;farm&#39;</span><span class="p">:</span>
</span><span class='line'>                <span class="n">farm_something</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p> 结果如下：</p>

<p><img src="/images/blog/plant_build.png" alt="" /></p>

<p>改进了一下代码，去掉了不必要的线程名，这样就不用去考虑命名重复的问题了。另外把线程类简化成一个内部函数：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/env python</span>
</span><span class='line'><span class="c"># -*- coding: utf-8 -*-</span>
</span><span class='line'><span class="c"># Last Update:</span>
</span><span class='line'>
</span><span class='line'><span class="n">__revision__</span> <span class="o">=</span> <span class="s">&#39;0.1&#39;</span>
</span><span class='line'><span class="n">__author__</span> <span class="o">=</span> <span class="s">&#39;lxd&#39;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">threading</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">time</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">TimeWorks</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">wait_works</span> <span class="o">=</span> <span class="p">{}</span><span class="c">#等待工作列表，包括工作的所有细节</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">wait_times_threads</span> <span class="o">=</span> <span class="p">[]</span><span class="c">#线程列表</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">setTime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">seconds</span><span class="p">):</span>
</span><span class='line'>        <span class="sd">&quot;&quot;&quot;将data放入等待工作列表中，并将工作放入线程中等待</span>
</span><span class='line'><span class="sd">        &quot;&quot;&quot;</span>
</span><span class='line'>        <span class="k">def</span> <span class="nf">sleep</span><span class="p">(</span><span class="n">seconds</span><span class="p">):</span>
</span><span class='line'>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">atime</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span> <span class="o">=</span> <span class="n">sleep</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">seconds</span><span class="p">,</span> <span class="p">))</span>
</span><span class='line'>        <span class="n">atime</span><span class="o">.</span><span class="n">setDaemon</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>        <span class="n">atime</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">wait_times_threads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atime</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">wait_works</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">atime</span><span class="o">.</span><span class="n">name</span><span class="p">:</span><span class="n">data</span><span class="p">})</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">checkTimeThread</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="sd">&quot;&quot;&quot;获得时间已到的工作</span>
</span><span class='line'><span class="sd">        &quot;&quot;&quot;</span>
</span><span class='line'>        <span class="k">for</span> <span class="n">atime</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_times_threads</span><span class="p">:</span>
</span><span class='line'>            <span class="k">if</span> <span class="ow">not</span> <span class="n">atime</span><span class="o">.</span><span class="n">isAlive</span><span class="p">():</span>
</span><span class='line'>                <span class="bp">self</span><span class="o">.</span><span class="n">wait_times_threads</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">atime</span><span class="p">)</span>
</span><span class='line'>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_works</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">atime</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
</span><span class='line'>    <span class="k">print</span> <span class="s">&#39;start&#39;</span>
</span><span class='line'>    <span class="n">timeWorks</span> <span class="o">=</span> <span class="n">TimeWorks</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">build</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;kind&#39;</span><span class="p">:</span><span class="s">&#39;build&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span><span class="s">&#39;build1&#39;</span><span class="p">,</span> <span class="s">&#39;pos&#39;</span><span class="p">:(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)}</span>
</span><span class='line'>    <span class="n">timeWorks</span><span class="o">.</span><span class="n">setTime</span><span class="p">(</span><span class="n">build</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">farm</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;kind&#39;</span><span class="p">:</span><span class="s">&#39;farm&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span><span class="s">&#39;tom&#39;</span><span class="p">,</span> <span class="s">&#39;pos&#39;</span><span class="p">:(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)}</span>
</span><span class='line'>    <span class="n">timeWorks</span><span class="o">.</span><span class="n">setTime</span><span class="p">(</span><span class="n">farm</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">build_something</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span><span class='line'>        <span class="k">print</span> <span class="s">&#39;build_something&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">farm_something</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span><span class='line'>        <span class="k">print</span> <span class="s">&#39;farm_something&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
</span><span class='line'>        <span class="k">print</span> <span class="s">&#39;do_something&#39;</span><span class="p">,</span> <span class="n">i</span>
</span><span class='line'>        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">data</span> <span class="o">=</span> <span class="n">timeWorks</span><span class="o">.</span><span class="n">checkTimeThread</span><span class="p">()</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
</span><span class='line'>            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;kind&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;build&#39;</span><span class="p">:</span>
</span><span class='line'>                <span class="n">build_something</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span class='line'>            <span class="k">elif</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;kind&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;farm&#39;</span><span class="p">:</span>
</span><span class='line'>                <span class="n">farm_something</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/12/24/draw-algorithm/">算法时间复杂度直观展示</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-12-24T00:00:00+08:00" pubdate data-updated="true">2010-12-24</time>
        
      </p>
    

<style type="text/css" media="screen">
  .jiathis .flash-video{
    border: 0;
  }
</style>
    <div class="jiathis">
<!-- JiaThis Button BEGIN -->
<div id="ckepop">
	<span class="jiathis_txt">分享到：</span>
	<a class="jiathis_button_tools_1"></a>
	<a class="jiathis_button_tools_2"></a>
	<a class="jiathis_button_tools_3"></a>
	<a class="jiathis_button_tools_4"></a>
	<a href="http://www.jiathis.com/share?uid=1532263" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
</div>
<script type="text/javascript">var jiathis_config = {data_track_clickback:true};</script>
<script type="text/javascript" src="http://v2.jiathis.com/code/jia.js?uid=1532263" charset="utf-8"></script>
<!-- JiaThis Button END -->
    </div>
  </header>


  <div class="entry-content"><p>整天看算法复杂度说什么冒泡排序o(N*N)，快排o(NlogN)，今天有空实际画了下，还真是差别挺大的。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/env python</span>
</span><span class='line'><span class="c"># -*- coding: utf-8 -*-</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
</span><span class='line'>
</span><span class='line'><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span class='line'><span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">s1</span> <span class="o">=</span> <span class="n">n</span><span class="o">**</span><span class="mi">2</span>
</span><span class='line'><span class="n">s2</span> <span class="o">=</span> <span class="n">n</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span class='line'><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="s">&#39;b-&#39;</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="s">&#39;r-&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s">r&#39;$n^2$&#39;</span><span class="p">,</span> <span class="s">&#39;nlog(n)&#39;</span><span class="p">),</span> <span class="n">shadow</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p> 效果：</p>

<p><img src="/images/blog/algorithm.png" alt="" /></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/12/17/python-embed-web-browser/">python嵌入IE浏览器</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-12-17T00:00:00+08:00" pubdate data-updated="true">2010-12-17</time>
        
      </p>
    

<style type="text/css" media="screen">
  .jiathis .flash-video{
    border: 0;
  }
</style>
    <div class="jiathis">
<!-- JiaThis Button BEGIN -->
<div id="ckepop">
	<span class="jiathis_txt">分享到：</span>
	<a class="jiathis_button_tools_1"></a>
	<a class="jiathis_button_tools_2"></a>
	<a class="jiathis_button_tools_3"></a>
	<a class="jiathis_button_tools_4"></a>
	<a href="http://www.jiathis.com/share?uid=1532263" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
</div>
<script type="text/javascript">var jiathis_config = {data_track_clickback:true};</script>
<script type="text/javascript" src="http://v2.jiathis.com/code/jia.js?uid=1532263" charset="utf-8"></script>
<!-- JiaThis Button END -->
    </div>
  </header>


  <div class="entry-content"><p>今天在研究visual studio 2008中的WebBroswer时忽然想到，对于我的简单需求（只想在程序中嵌入一个浏览器，而不是开发一个浏览器程序与Chrome、Firefox竞争）来说，只需要简单的调用IE就可以了（我的程序只是针对windows用户），这样的另一个好处是如果用户用IE曾经载入过的文件（如Flash游戏），用我的嵌入式浏览器就不用再次载入的。比以前的思路更符合我的需求，因此我决定顺着这个思路找找看，结果发现人家wxpython早就有了web.lib.iewin，骑驴找驴的事情再次发生~</p>

<p>关键代码：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="bp">self</span><span class="o">.</span><span class="n">ie</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">iewin</span><span class="o">.</span><span class="n">IEHtmlWindow</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>打开网页：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="bp">self</span><span class="o">.</span><span class="n">ie</span><span class="o">.</span><span class="n">LoadUrl</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>如此简单~</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/12/17/help-tortoisehg/">为tortoisehg出把力</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-12-17T00:00:00+08:00" pubdate data-updated="true">2010-12-17</time>
        
      </p>
    

<style type="text/css" media="screen">
  .jiathis .flash-video{
    border: 0;
  }
</style>
    <div class="jiathis">
<!-- JiaThis Button BEGIN -->
<div id="ckepop">
	<span class="jiathis_txt">分享到：</span>
	<a class="jiathis_button_tools_1"></a>
	<a class="jiathis_button_tools_2"></a>
	<a class="jiathis_button_tools_3"></a>
	<a class="jiathis_button_tools_4"></a>
	<a href="http://www.jiathis.com/share?uid=1532263" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
</div>
<script type="text/javascript">var jiathis_config = {data_track_clickback:true};</script>
<script type="text/javascript" src="http://v2.jiathis.com/code/jia.js?uid=1532263" charset="utf-8"></script>
<!-- JiaThis Button END -->
    </div>
  </header>


  <div class="entry-content"><p><a href="https://bitbucket.org/tortoisehg/stable/issue/936/importerror-memoryloadlibrary-failed-loading#comment-280484">https://bitbucket.org/tortoisehg/stable/issue/936/importerror-memoryloadlibrary-failed-loading#comment-280484</a></p>

<p>开源项目：tortoisehg</p>

<p>bug内容：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#936 ImportError: MemoryLoadLibrary failed loading win32api.pyd
</span><span class='line'>Reported by Dmitry Zanozin / dmitryzan, created 10 months ago.
</span><span class='line'>I've received error message on startup of my WinXP after reboot just after install of the latest nightly build tortoisehg-unstable-0.9.35067-hg-1.4.3+67-07bd7608a0ea.exe
</span><span class='line'>There was a suggestion to examine thgtaskbar.exe.log file:
</span><span class='line'>thgtaskbar.exe.log
</span><span class='line'>Traceback (most recent call last):
</span><span class='line'>File "thgtaskbar.py", line 13, in &lt;module&gt;
</span><span class='line'>File "zipextimporter.pyo", line 98, in load_module
</span><span class='line'>ImportError: MemoryLoadLibrary failed loading win32api.pyd</span></code></pre></td></tr></table></div></figure>


<p>偶的解决方案：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>istonelee
</span><span class='line'>written about a month ago
</span><span class='line'>when I use py2exe to create my project,I receive the same error.I analyse the depends of this dll,and found that py2exe makes some mistakes that include mswsock.dll and powrprof.dll into the library. and my solution is modify the setup.py
</span><span class='line'>'dll_excludes': [ "mswsock.dll", "powrprof.dll" ]
</span><span class='line'>hope my experience could be any useful :)</span></code></pre></td></tr></table></div></figure>


<p>被作者采纳了：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Steve Borho / sborho
</span><span class='line'>written about a month ago
</span><span class='line'>That is interesting that it causes the same error for you. I've added those two and several more DLLs to the dll_excludes list in the setup.cfg file. setup.cfg hasn't changed in 9 months, since 1.0 was released.
</span><span class='line'>http://bitbucket.org/tortoisehg/thg-winbuild/src/tip/misc/setup.cfg</span></code></pre></td></tr></table></div></figure>


<p>So Happy~</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/12/08/wxwebkit-simple-web-browser/">基于wxwebkit实现简单的浏览器</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-12-08T00:00:00+08:00" pubdate data-updated="true">2010-12-08</time>
        
      </p>
    

<style type="text/css" media="screen">
  .jiathis .flash-video{
    border: 0;
  }
</style>
    <div class="jiathis">
<!-- JiaThis Button BEGIN -->
<div id="ckepop">
	<span class="jiathis_txt">分享到：</span>
	<a class="jiathis_button_tools_1"></a>
	<a class="jiathis_button_tools_2"></a>
	<a class="jiathis_button_tools_3"></a>
	<a class="jiathis_button_tools_4"></a>
	<a href="http://www.jiathis.com/share?uid=1532263" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
</div>
<script type="text/javascript">var jiathis_config = {data_track_clickback:true};</script>
<script type="text/javascript" src="http://v2.jiathis.com/code/jia.js?uid=1532263" charset="utf-8"></script>
<!-- JiaThis Button END -->
    </div>
  </header>


  <div class="entry-content"><p>如何在python应用程序中嵌入浏览器？google半天之后发现 <a href="http://wxwebkit.wxcommunity.com/">wxWebKit</a> 是一个相对给力的webkit封装，虽然也有相当多的不足之处，但是对于简单的html渲染是没用问题的，直接给出代码。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/env python</span>
</span><span class='line'><span class="c"># -*- coding: utf-8 -*-</span>
</span><span class='line'>
</span><span class='line'><span class="n">__revision__</span> <span class="o">=</span> <span class="s">&#39;0.1&#39;</span>
</span><span class='line'><span class="n">__author__</span> <span class="o">=</span> <span class="s">&#39;lxd&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">wx</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">wx.webview</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">MainFrame</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Frame</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="n">wx</span><span class="o">.</span><span class="n">Frame</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">600</span><span class="p">))</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">html</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">webview</span><span class="o">.</span><span class="n">WebView</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">btnLoad</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">u&#39;进入&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnLoadClick</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">btnLoad</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">layout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">Center</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">setupBox</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">u&#39;基本设置&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="n">setupSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticBoxSizer</span><span class="p">(</span><span class="n">setupBox</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
</span><span class='line'>        <span class="n">setupSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span><span class='line'>        <span class="n">setupSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btnLoad</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">mainSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
</span><span class='line'>        <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">setupSizer</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span><span class='line'>        <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">html</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">SetSizer</span><span class="p">(</span><span class="n">mainSizer</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">OnLoadClick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">LoadURL</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
</span><span class='line'>    <span class="n">app</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">PySimpleApp</span><span class="p">()</span>
</span><span class='line'>    <span class="n">main</span> <span class="o">=</span> <span class="n">MainFrame</span><span class="p">()</span>
</span><span class='line'>    <span class="n">main</span><span class="o">.</span><span class="n">Show</span><span class="p">()</span>
</span><span class='line'>    <span class="n">app</span><span class="o">.</span><span class="n">MainLoop</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>输入www.baidu.com没有问题，如果登录的话就杯具了&#8230;还有很多工作要做&#8230;貌似没有flash，没有cookie&#8230;希望有人能在这个基础上继续完善。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/11/17/use-cscope-in-vim-to-query-python-project/">Windows使用vim插件cscope查询python项目</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-17T00:00:00+08:00" pubdate data-updated="true">2010-11-17</time>
        
      </p>
    

<style type="text/css" media="screen">
  .jiathis .flash-video{
    border: 0;
  }
</style>
    <div class="jiathis">
<!-- JiaThis Button BEGIN -->
<div id="ckepop">
	<span class="jiathis_txt">分享到：</span>
	<a class="jiathis_button_tools_1"></a>
	<a class="jiathis_button_tools_2"></a>
	<a class="jiathis_button_tools_3"></a>
	<a class="jiathis_button_tools_4"></a>
	<a href="http://www.jiathis.com/share?uid=1532263" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
</div>
<script type="text/javascript">var jiathis_config = {data_track_clickback:true};</script>
<script type="text/javascript" src="http://v2.jiathis.com/code/jia.js?uid=1532263" charset="utf-8"></script>
<!-- JiaThis Button END -->
    </div>
  </header>


  <div class="entry-content"><p>cscope可以方便的查找函数在哪里被调用，或者标签在哪些地方出现过，vim可以对其进行很好的集成。</p>

<ol>
<li>首先确保vim支持cscope，否则需要重新编译一下。</li>
<li>下载cscope的windows版本，将其解压缩，然后设置到环境变量里。</li>
<li>下载vim插件 <a href="http://cscope.sourceforge.net/cscope_maps.vim">cscope_maps</a> ，放到plugin里。</li>
<li>生成索引数据库文件。默认情况下cscope只认识c文件，为了保证我可爱的python使用，需要自己生成files文件来告诉cscope。windows下没有好用的find命令，所以自己写个，代码如下：</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="sd">&#39;&#39;&#39;生成cscope.files并生成out文件</span>
</span><span class='line'><span class="sd">&#39;&#39;&#39;</span>
</span><span class='line'><span class="n">__revision__</span> <span class="o">=</span> <span class="s">&#39;0.1&#39;</span>
</span><span class='line'><span class="n">__author__</span> <span class="o">=</span> <span class="s">&#39;lxd&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">PATH</span><span class="o">=</span> <span class="s">r&#39;C:\Users\lxd\Desktop\register&#39;</span>
</span><span class='line'><span class="n">FILE_TYPE_LIST</span><span class="o">=</span> <span class="p">[</span><span class="s">&#39;py&#39;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
</span><span class='line'>    <span class="kn">import</span> <span class="nn">os</span>
</span><span class='line'>    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;cscope.files&#39;</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">root</span><span class="p">,</span><span class="n">dirs</span><span class="p">,</span><span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">PATH</span><span class="p">):</span>
</span><span class='line'>        <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
</span><span class='line'>            <span class="k">for</span> <span class="n">file_type</span> <span class="ow">in</span> <span class="n">FILE_TYPE_LIST</span><span class="p">:</span>
</span><span class='line'>                <span class="k">if</span> <span class="nb">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">file_type</span><span class="p">:</span>
</span><span class='line'>                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="nb">file</span><span class="p">))</span>
</span><span class='line'>    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span class='line'>    <span class="n">cmd</span> <span class="o">=</span> <span class="s">&#39;cscope -bk&#39;</span>
</span><span class='line'>    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>使用时需要将这个文件放到项目目录下，然后更改PATH路径，程序会自动生成cscope.files文件和cscope.out文件，其中cscope.out就是要使用的索引了。</p>

<p>5.打开vim，</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="p">:</span><span class="n">cscope</span> <span class="n">add</span> <span class="n">cscope</span><span class="o">.</span><span class="n">out</span>
</span></code></pre></td></tr></table></div></figure>


<p>数据库就成功添加了。</p>

<p>@现在在函数名上ctrl+\ 然后s@<br/>
函数调用都出来了吧&#8230;</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/11/02/python-project-pack-in-windows/">Windows下python打包完整解决方案</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-02T00:00:00+08:00" pubdate data-updated="true">2010-11-02</time>
        
      </p>
    

<style type="text/css" media="screen">
  .jiathis .flash-video{
    border: 0;
  }
</style>
    <div class="jiathis">
<!-- JiaThis Button BEGIN -->
<div id="ckepop">
	<span class="jiathis_txt">分享到：</span>
	<a class="jiathis_button_tools_1"></a>
	<a class="jiathis_button_tools_2"></a>
	<a class="jiathis_button_tools_3"></a>
	<a class="jiathis_button_tools_4"></a>
	<a href="http://www.jiathis.com/share?uid=1532263" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
</div>
<script type="text/javascript">var jiathis_config = {data_track_clickback:true};</script>
<script type="text/javascript" src="http://v2.jiathis.com/code/jia.js?uid=1532263" charset="utf-8"></script>
<!-- JiaThis Button END -->
    </div>
  </header>


  <div class="entry-content"><p>最近想把写的python代码打包，以供没用安装python环境的同事使用，需求如下：</p>

<ul>
<li>无python环境也可执行</li>
<li>文件尽量少，不要太乱</li>
<li>程序体积尽量小</li>
<li>如果需要更新的话重复类库不用更新</li>
</ul>


<p>采用方案如下：</p>

<ol>
<li>使用py2exe自动导入类库</li>
<li>使用7-ZIP压缩library</li>
<li>upx压缩dll等文件</li>
<li>nsis生成安装文件</li>
<li>采用md5验证的方式判别不用更新的类库</li>
</ol>


<h2>使用py2exe自动导入类库</h2>

<p>建立文件bin_setup.py</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/env python</span>
</span><span class='line'><span class="c"># -*- coding: utf-8 -*-</span>
</span><span class='line'>
</span><span class='line'><span class="n">__author__</span> <span class="o">=</span> <span class="s">&#39;lxd&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">from</span> <span class="nn">distutils.core</span> <span class="kn">import</span> <span class="n">setup</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">py2exe</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">sys</span>
</span><span class='line'>
</span><span class='line'><span class="c"># If run without args, build executables, in quiet mode.</span>
</span><span class='line'><span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span class='line'>    <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;py2exe&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;-q&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">INCLUDES</span> <span class="o">=</span> <span class="p">[]</span>
</span><span class='line'>
</span><span class='line'><span class="n">MANIFEST_TEMPLATE</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
</span><span class='line'><span class="s">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;</span>
</span><span class='line'><span class="s">&lt;assembly xmlns=&quot;urn:schemas-microsoft-com:asm.v1&quot; manifestVersion=&quot;1.0&quot;&gt;</span>
</span><span class='line'><span class="s">  &lt;assemblyIdentity</span>
</span><span class='line'><span class="s">    version=&quot;5.0.0.0&quot;</span>
</span><span class='line'><span class="s">    processorArchitecture=&quot;x86&quot;</span>
</span><span class='line'><span class="s">    name=&quot;</span><span class="si">%(prog)s</span><span class="s">&quot;</span>
</span><span class='line'><span class="s">    type=&quot;win32&quot;</span>
</span><span class='line'><span class="s">  /&gt;</span>
</span><span class='line'><span class="s">  &lt;description&gt;</span><span class="si">%(prog)s</span><span class="s">&lt;/description&gt;</span>
</span><span class='line'><span class="s">  &lt;trustInfo xmlns=&quot;urn:schemas-microsoft-com:asm.v3&quot;&gt;</span>
</span><span class='line'><span class="s">    &lt;security&gt;</span>
</span><span class='line'><span class="s">      &lt;requestedPrivileges&gt;</span>
</span><span class='line'><span class="s">        &lt;requestedExecutionLevel</span>
</span><span class='line'><span class="s">            level=&quot;asInvoker&quot;</span>
</span><span class='line'><span class="s">            uiAccess=&quot;false&quot;&gt;</span>
</span><span class='line'><span class="s">        &lt;/requestedExecutionLevel&gt;</span>
</span><span class='line'><span class="s">      &lt;/requestedPrivileges&gt;</span>
</span><span class='line'><span class="s">    &lt;/security&gt;</span>
</span><span class='line'><span class="s">  &lt;/trustInfo&gt;</span>
</span><span class='line'><span class="s">  &lt;dependency&gt;</span>
</span><span class='line'><span class="s">    &lt;dependentAssembly&gt;</span>
</span><span class='line'><span class="s">      &lt;assemblyIdentity</span>
</span><span class='line'><span class="s">            type=&quot;win32&quot;</span>
</span><span class='line'><span class="s">            name=&quot;Microsoft.VC90.CRT&quot;</span>
</span><span class='line'><span class="s">            version=&quot;9.0.21022.8&quot;</span>
</span><span class='line'><span class="s">            processorArchitecture=&quot;x86&quot;</span>
</span><span class='line'><span class="s">            publicKeyToken=&quot;1fc8b3b9a1e18e3b&quot;&gt;</span>
</span><span class='line'><span class="s">      &lt;/assemblyIdentity&gt;</span>
</span><span class='line'><span class="s">    &lt;/dependentAssembly&gt;</span>
</span><span class='line'><span class="s">  &lt;/dependency&gt;</span>
</span><span class='line'><span class="s">  &lt;dependency&gt;</span>
</span><span class='line'><span class="s">    &lt;dependentAssembly&gt;</span>
</span><span class='line'><span class="s">        &lt;assemblyIdentity</span>
</span><span class='line'><span class="s">            type=&quot;win32&quot;</span>
</span><span class='line'><span class="s">            name=&quot;Microsoft.Windows.Common-Controls&quot;</span>
</span><span class='line'><span class="s">            version=&quot;6.0.0.0&quot;</span>
</span><span class='line'><span class="s">            processorArchitecture=&quot;X86&quot;</span>
</span><span class='line'><span class="s">            publicKeyToken=&quot;6595b64144ccf1df&quot;</span>
</span><span class='line'><span class="s">            language=&quot;*&quot;</span>
</span><span class='line'><span class="s">        /&gt;</span>
</span><span class='line'><span class="s">    &lt;/dependentAssembly&gt;</span>
</span><span class='line'><span class="s">  &lt;/dependency&gt;</span>
</span><span class='line'><span class="s">&lt;/assembly&gt;</span>
</span><span class='line'><span class="s">&quot;&quot;&quot;</span>
</span><span class='line'><span class="n">RT_MANIFEST</span> <span class="o">=</span> <span class="mi">24</span>
</span><span class='line'>
</span><span class='line'><span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;py2exe&quot;</span> <span class="p">:</span>
</span><span class='line'>    <span class="p">{</span><span class="s">&quot;compressed&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>     <span class="s">&quot;optimize&quot;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span><span class='line'>     <span class="s">&quot;bundle_files&quot;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span><span class='line'>     <span class="s">&quot;includes&quot;</span> <span class="p">:</span> <span class="n">INCLUDES</span><span class="p">,</span>
</span><span class='line'>     <span class="s">&quot;excludes&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="s">&quot;Tkinter&quot;</span><span class="p">,],</span>
</span><span class='line'>     <span class="s">&quot;dll_excludes&quot;</span><span class="p">:</span> <span class="p">[</span> <span class="s">&quot;MSVCP90.dll&quot;</span><span class="p">,</span> <span class="s">&quot;mswsock.dll&quot;</span><span class="p">,</span> <span class="s">&quot;powrprof.dll&quot;</span><span class="p">]</span> <span class="p">}}</span>
</span><span class='line'>
</span><span class='line'><span class="n">windows</span> <span class="o">=</span> <span class="p">[{</span><span class="s">&quot;script&quot;</span><span class="p">:</span> <span class="s">&quot;bin.py&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;icon_resources&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;bin.ico&quot;</span><span class="p">)],</span>
</span><span class='line'>      <span class="s">&quot;other_resources&quot;</span> <span class="p">:</span> <span class="p">[(</span><span class="n">RT_MANIFEST</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>                        <span class="n">MANIFEST_TEMPLATE</span> <span class="o">%</span> <span class="nb">dict</span><span class="p">(</span><span class="n">prog</span><span class="o">=</span><span class="s">&quot;MyAppName&quot;</span><span class="p">))],</span>
</span><span class='line'>      <span class="p">}]</span>
</span><span class='line'>
</span><span class='line'><span class="n">setup</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;MyApp&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="n">version</span> <span class="o">=</span> <span class="s">&quot;1.0&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="n">description</span> <span class="o">=</span> <span class="s">&quot;Description of the app&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="n">author</span> <span class="o">=</span> <span class="s">&quot;Author Name&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="n">author_email</span> <span class="o">=</span><span class="s">&quot;author@project.com&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="n">maintainer</span> <span class="o">=</span> <span class="s">&quot;Maintainer Name&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="n">maintainer_email</span> <span class="o">=</span> <span class="s">&quot;you@project.com&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="n">license</span> <span class="o">=</span> <span class="s">&quot;wxWindows Licence&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="n">url</span> <span class="o">=</span> <span class="s">&quot;http://projecthomepage.com&quot;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">data_files</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;MSVCR90.dll&quot;</span><span class="p">,</span> <span class="s">&quot;gdiplus.dll&quot;</span><span class="p">],</span>
</span><span class='line'>      <span class="c">#data_files=[(&quot;img&quot;,[r&quot;d:\test\1.gif&quot;,r&quot;d:\test\2.gif&quot;]),(&quot;xml&quot;,[r&quot;d:\test\1.xml&quot;,r&quot;d:\test\2.xml&quot;])])</span>
</span><span class='line'>      <span class="c">#zipfile=None,</span>
</span><span class='line'>      <span class="n">options</span> <span class="o">=</span> <span class="n">options</span><span class="p">,</span>
</span><span class='line'>      <span class="n">windows</span> <span class="o">=</span> <span class="n">windows</span><span class="p">,</span>
</span><span class='line'>      <span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>使用7-ZIP压缩library,使用upx压缩dll等文件</h2>

<p>建立脚本bin.cmd</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
</pre></td><td class='code'><pre><code class='bat'><span class='line'><span class="p">@</span><span class="k">echo</span> <span class="k">off</span>
</span><span class='line'>
</span><span class='line'><span class="c">::Set personal Path to the Apps:</span>
</span><span class='line'><span class="k">set</span> <span class="nv">PythonEXE</span><span class="o">=</span>D:\Python<span class="m">26</span>\python.exe
</span><span class='line'><span class="k">set</span> <span class="nv">SevenZipEXE</span><span class="o">=</span><span class="s2">&quot;D:\Program Files\7-ZIP\7z.exe&quot;</span>
</span><span class='line'><span class="k">set</span> <span class="nv">UpxEXE</span><span class="o">=</span><span class="s2">&quot;D:\Program Files\upx\upx.exe&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c">:: Compress=1 - Use CompressFiles</span>
</span><span class='line'><span class="c">:: Compress=0 - Don&#39;t CompressFiles</span>
</span><span class='line'><span class="k">set</span> <span class="nv">Compress</span><span class="o">=</span><span class="m">1</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> not <span class="k">exist</span> <span class="nv">%~dpn0</span>.py          <span class="k">call</span> <span class="nl">:FileNotFound</span> <span class="nv">%~dpn0</span>.py
</span><span class='line'><span class="k">if</span> not <span class="k">exist</span> <span class="nv">%PythonEXE%</span>        <span class="k">call</span> <span class="nl">:FileNotFound</span> <span class="nv">%PythonEXE%</span>
</span><span class='line'><span class="k">if</span> not <span class="k">exist</span> <span class="nv">%SevenZipEXE%</span>      <span class="k">call</span> <span class="nl">:FileNotFound</span> <span class="nv">%SevenZipEXE%</span>
</span><span class='line'><span class="k">if</span> not <span class="k">exist</span> <span class="nv">%UpxEXE%</span>           <span class="k">call</span> <span class="nl">:FileNotFound</span> <span class="nv">%UpxEXE%</span>
</span><span class='line'>
</span><span class='line'><span class="c">::Compile the Python-Script</span>
</span><span class='line'><span class="nv">%PythonEXE%</span> <span class="s2">&quot;%~dpn0_setup.py&quot;</span> py<span class="m">2</span>exe
</span><span class='line'><span class="k">if</span> not <span class="s2">&quot;%errorlevel%&quot;</span><span class="o">==</span><span class="s2">&quot;0&quot;</span> (
</span><span class='line'>        <span class="k">echo</span> Py<span class="m">2</span>EXE Error!
</span><span class='line'>        <span class="k">pause</span>
</span><span class='line'>        <span class="k">goto</span><span class="nl">:eof</span>
</span><span class='line'>)
</span><span class='line'>
</span><span class='line'><span class="c">:: Copy the Py2EXE Results to the SubDirectory and Clean Py2EXE-Results</span>
</span><span class='line'>rd build <span class="n">/s</span> <span class="n">/q</span>
</span><span class='line'>xcopy dist\*.* <span class="s2">&quot;%~dpn0_EXE\&quot;</span> <span class="n">/d</span> <span class="n">/y</span>
</span><span class='line'><span class="c">:: I use xcopy dist\*.* &quot;%~dpn0_EXE\&quot; /s /d /y</span>
</span><span class='line'><span class="c">:: This is necessary when you have subdirectories - like when you use Tkinter</span>
</span><span class='line'>rd dist <span class="n">/s</span> <span class="n">/q</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="s2">&quot;%Compress%&quot;</span><span class="o">==</span><span class="s2">&quot;1&quot;</span> <span class="k">call</span><span class="nl">:CompressFiles</span>
</span><span class='line'><span class="k">echo</span>.
</span><span class='line'><span class="k">echo</span>.
</span><span class='line'><span class="k">echo</span> Done: <span class="s2">&quot;%~dpn0_EXE\&quot;</span>
</span><span class='line'><span class="k">echo</span>.
</span><span class='line'><span class="k">pause</span>
</span><span class='line'><span class="k">goto</span><span class="nl">:eof</span>
</span><span class='line'>
</span><span class='line'><span class="nl">:CompressFiles</span>
</span><span class='line'>        <span class="nv">%SevenZipEXE%</span> -aoa x <span class="s2">&quot;%~dpn0_EXE\library.zip&quot;</span> -o<span class="s2">&quot;%~dpn0_EXE\library\&quot;</span>
</span><span class='line'>        <span class="k">del</span> <span class="s2">&quot;%~dpn0_EXE\library.zip&quot;</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">cd</span> <span class="nv">%~dpn0_EXE</span>\library\
</span><span class='line'>        <span class="nv">%SevenZipEXE%</span> a -tzip -mx<span class="m">9</span> <span class="s2">&quot;..\library.zip&quot;</span> -r
</span><span class='line'>        <span class="k">cd</span>..
</span><span class='line'>        rd <span class="s2">&quot;%~dpn0_EXE\library&quot;</span> <span class="n">/s</span> <span class="n">/q</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">cd</span> <span class="nv">%~dpn0_EXE</span>\
</span><span class='line'>        <span class="nv">%UpxEXE%</span> --best *.*
</span><span class='line'><span class="k">goto</span><span class="nl">:eof</span>
</span><span class='line'>
</span><span class='line'><span class="nl">:FileNotFound</span>
</span><span class='line'>        <span class="k">echo</span>.
</span><span class='line'>        <span class="k">echo</span> Error<span class="p">,</span> File not found:
</span><span class='line'>        <span class="k">echo</span> [<span class="nv">%1</span>]
</span><span class='line'>        <span class="k">echo</span>.
</span><span class='line'>        <span class="k">echo</span> Check Path in <span class="nv">%~nx0</span>???
</span><span class='line'>        <span class="k">echo</span>.
</span><span class='line'>        <span class="k">pause</span>
</span><span class='line'>        exit
</span><span class='line'><span class="k">goto</span><span class="nl">:eof</span>
</span></code></pre></td></tr></table></div></figure>


<h2>使用方法</h2>

<p>直接运行bin.cmd，程序会自动调用bin_setup.py来查找需要的类库，然后对类库文件进行压缩，生成的可执行文件在bin_EXE里。</p>

<h2>问题</h2>

<p>我在打包的时候，出现错误“ImportError: MemoryLoadLibrary failed loading win32api.pyd”，用depends.exe查看其引用，然后多方搜索得知，其原因是py2exe错误的加载了mswsock.dll，powrprof.dll这两个文件，因此将它们排除即可。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="s">&quot;dll_excludes&quot;</span><span class="p">:</span> <span class="p">[</span> <span class="s">&quot;MSVCP90.dll&quot;</span><span class="p">,</span> <span class="s">&quot;mswsock.dll&quot;</span><span class="p">,</span> <span class="s">&quot;powrprof.dll&quot;</span><span class="p">]</span> <span class="p">}}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>nsis生成安装文件</h2>

<p>待续。。。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/10/24/closure-bug-in-python/">Python闭包实现的所谓bug</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-10-24T00:00:00+08:00" pubdate data-updated="true">2010-10-24</time>
        
      </p>
    

<style type="text/css" media="screen">
  .jiathis .flash-video{
    border: 0;
  }
</style>
    <div class="jiathis">
<!-- JiaThis Button BEGIN -->
<div id="ckepop">
	<span class="jiathis_txt">分享到：</span>
	<a class="jiathis_button_tools_1"></a>
	<a class="jiathis_button_tools_2"></a>
	<a class="jiathis_button_tools_3"></a>
	<a class="jiathis_button_tools_4"></a>
	<a href="http://www.jiathis.com/share?uid=1532263" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
</div>
<script type="text/javascript">var jiathis_config = {data_track_clickback:true};</script>
<script type="text/javascript" src="http://v2.jiathis.com/code/jia.js?uid=1532263" charset="utf-8"></script>
<!-- JiaThis Button END -->
    </div>
  </header>


  <div class="entry-content"><p>思路来自 <a href="http://groups.google.com/group/python-cn/browse_thread/thread/895f25d6303de2ec?hl=zh-CN#">http://groups.google.com/group/python-cn/browse_thread/thread/895f25d6303de2ec?hl=zh-CN#</a>
整理记录下来，让墙内的人也看看。</p>

<h2>问题描述</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">fs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span class='line'><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">i</span> <span class="o">+</span> <span class="n">n</span>
</span><span class='line'>    <span class="n">fs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span class='line'><span class="k">print</span> <span class="p">[</span><span class="n">f</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fs</span><span class="p">]</span>
</span><span class='line'><span class="k">print</span> <span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fs</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>结果为：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="p">[</span><span class="mi">13</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span>
</span><span class='line'><span class="p">[</span><span class="mi">145743064</span><span class="p">,</span> <span class="mi">145743064</span><span class="p">,</span> <span class="mi">145743064</span><span class="p">,</span> <span class="mi">145743064</span><span class="p">,</span> <span class="mi">145743064</span><span class="p">,</span> <span class="mi">145743064</span><span class="p">,</span> <span class="mi">145743064</span><span class="p">,</span> <span class="mi">14</span>
</span><span class='line'><span class="mi">5743064</span><span class="p">,</span> <span class="mi">145743064</span><span class="p">,</span> <span class="mi">145743064</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>很奇怪的结果吧。
问题所在：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">fs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span class='line'><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span><span class='line'>        <span class="k">print</span> <span class="nb">locals</span><span class="p">()</span>
</span><span class='line'>        <span class="k">print</span> <span class="s">&#39;i&#39;</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">()</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">i</span> <span class="o">+</span> <span class="n">n</span>
</span><span class='line'>    <span class="n">fs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span class='line'><span class="k">print</span> <span class="p">[</span><span class="n">f</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fs</span><span class="p">]</span>
</span><span class='line'><span class="k">print</span> <span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fs</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>结果为</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="nb">locals</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;n&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>
</span><span class='line'><span class="n">i</span> <span class="ow">in</span> <span class="nb">globals</span> <span class="ow">is</span><span class="p">:</span> <span class="bp">True</span>
</span></code></pre></td></tr></table></div></figure>


<p>可以看到i根本就没有封闭在f()里，而是个全局变量，因此出现上面的结果也就不奇怪了。
解决方案：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">fs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span class='line'><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">i</span> <span class="o">+</span> <span class="n">n</span>
</span><span class='line'>    <span class="n">fs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span class='line'><span class="k">print</span> <span class="p">[</span><span class="n">f</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fs</span><span class="p">]</span>
</span><span class='line'><span class="k">print</span> <span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fs</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>将全局变量i引入f中，这下结果正确了。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span>
</span><span class='line'><span class="p">[</span><span class="mi">143334724</span><span class="p">,</span> <span class="mi">143334712</span><span class="p">,</span> <span class="mi">143334700</span><span class="p">,</span> <span class="mi">143334688</span><span class="p">,</span> <span class="mi">143334676</span><span class="p">,</span> <span class="mi">143334664</span><span class="p">,</span> <span class="mi">143334652</span><span class="p">,</span> <span class="mi">14</span>
</span><span class='line'><span class="mi">3334640</span><span class="p">,</span> <span class="mi">143334628</span><span class="p">,</span> <span class="mi">143334616</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/10/18/compile-vim73-in-ubuntu1004/">在ubuntu 10.0.4上编译vim7.3</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-10-18T00:00:00+08:00" pubdate data-updated="true">2010-10-18</time>
        
      </p>
    

<style type="text/css" media="screen">
  .jiathis .flash-video{
    border: 0;
  }
</style>
    <div class="jiathis">
<!-- JiaThis Button BEGIN -->
<div id="ckepop">
	<span class="jiathis_txt">分享到：</span>
	<a class="jiathis_button_tools_1"></a>
	<a class="jiathis_button_tools_2"></a>
	<a class="jiathis_button_tools_3"></a>
	<a class="jiathis_button_tools_4"></a>
	<a href="http://www.jiathis.com/share?uid=1532263" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
</div>
<script type="text/javascript">var jiathis_config = {data_track_clickback:true};</script>
<script type="text/javascript" src="http://v2.jiathis.com/code/jia.js?uid=1532263" charset="utf-8"></script>
<!-- JiaThis Button END -->
    </div>
  </header>


  <div class="entry-content"><h2>编译前准备</h2>

<p>如果要编译GVIM，需要先安装必要的库，否则可能会报各种编译错误</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo apt-get install libncurses5-dev libgnome2-dev libgnomeui-dev libgtk2.0-dev libatk1.0-dev libbonoboui2-dev libcairo2-dev libx11-dev libxpm-dev libxt-dev
</span></code></pre></td></tr></table></div></figure>


<p>要添加python支持， 另外还需要python2.6-dev</p>

<h2>开始编译</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">cd </span>src
</span><span class='line'><span class="nv">$ </span>make distclean  <span class="c">#防止缓存</span>
</span><span class='line'><span class="nv">$ </span>./configure --with-features<span class="o">=</span>huge --enable-gui<span class="o">=</span>gnome2 --enable-cscope  --enable-fontset --enable-multibyte --enable-pythoninterp --with-python-config-dir<span class="o">=</span>/usr/lib/python2.6/config
</span><span class='line'><span class="nv">$ </span>make
</span><span class='line'><span class="nv">$ </span>sudo make install
</span></code></pre></td></tr></table></div></figure>


<h2>查看特性添加与否</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'><span class="p">:</span>version
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/6/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/4/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Who&#8217;s stonelee</h1>
  <a href="/about" style="float:left;"><img src="/images/stonelee.jpg"/></a>
  <style type="text/css">
    .about-info {
      display:inline-block;
    }
    .about-info p {
      margin-top: 0.5em;
      margin-bottom: 0;
      padding-left: 5px;
    }
    .about-info a {
      text-decoration: none;
    }
    .about-info a:hover {
      text-decoration: underline;
    }
  </style>
  <div class="about-info">
    <p><a href="mailto:istonelee@gmail.com">istonelee@gmail.com</a></p>
    <p><a href="http://www.weibo.com/imstonelee">新浪微博</a></p>
    <p><a href="http://www.douban.com/people/istonelee/">豆瓣</a></p>
    <p><a href="https://github.com/stonelee">Github</a></p>
    <p><a style="white-space:normal;display:block;" target="_blank" href="http://sighttp.qq.com/authd?IDKEY=aeec06efbfbbaa5a9a850656a0aab3788df4c572abb5206c">
      <img style="border:0;" border="0" src="http://wpa.qq.com/imgd?IDKEY=aeec06efbfbbaa5a9a850656a0aab3788df4c572abb5206c&pic=49" alt="点击这里给我发消息" title="点击这里给我发消息">
    </a></p>
  </div>
</section>

<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/03/18/underscore-style/">Underscore源码研究之多种编程范式实现</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/12/31/my-2012/">我的2012</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/10/09/spm-build/">构建基于spm的前端开发流水线</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/09/19/adblock-plus-bug/">当前端遇到Adblock Plus</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/08/22/bootstrap-modal/">Bootstrap modal源码分析</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/04/26/new-extjs-mvc/">ExtJS 4 mvc架构演化</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/02/16/extjs-4-build-tool/">ExtJS 4打包工具</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/02/01/ext-core-design-pattern/">Ext Core设计模式</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/01/30/ext-core-record/">Ext Core学习笔记</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/11/30/trick-on-jquery/">恶搞jquery</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/stonelee">@stonelee</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'stonelee',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>

<style type="text/css" media="screen">
  .jiathis_style{
    background: none;
    border: 0;
  }
</style>
<!-- JiaThis Button BEGIN -->
<script type="text/javascript">var jiathis_config = {data_track_clickback:true};</script>
<script type="text/javascript" src="http://v2.jiathis.com/code/jiathis_r.js?move=0&amp;uid=1532263" charset="utf-8"></script>
<!-- JiaThis Button END -->

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - stonelee -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'stonelee';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
